<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Atlântico Golf — Quadro Kanban por Encarregado</title>
  <meta name="description" content="Kanban semanal por encarregado com adição de cards completa, rolagem independente por coluna e cabeçalhos fixos." />
  <style>
    :root{
      --bg:#f5f7fb; --text:#111827; --muted:#475569; --brand:#005b96;
      --card:#ffffff; --border:#cbd5e1; --header:#f1f5f9;
      --ok:#16a34a; --warn:#ca8a04; --late:#b91c1c; --block:#9333ea; --exec:#0ea5e9; --recv:#15803d;
      --chip:#e2e8f0;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Arial,sans-serif;background:var(--bg);color:var(--text)}

    header{padding:14px;background:var(--brand);color:#fff;display:flex;justify-content:space-between;align-items:center}
    .brand{display:flex;align-items:center;gap:14px}
    .logo-box{width:160px;height:70px;background:#fff;border-radius:10px;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .logo-img{max-width:100%;max-height:100%;display:none}
    .logo-ph{width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#0f172a;font-weight:800}
    h1{margin:0;font-size:24px}

    .right{display:flex;align-items:center;gap:8px}
    .btn{background:#fff;color:#0f172a;border:0;border-radius:999px;padding:8px 12px;font-weight:700;cursor:pointer}
    .clock{font-variant-numeric:tabular-nums}

    .board{display:flex;gap:16px;padding:16px;height:calc(100% - 92px);overflow-x:auto;}
    .column{background:var(--card);border:1px solid var(--border);border-radius:10px;min-width:340px;max-width:520px;flex:1;display:flex;flex-direction:column}
    .col-header{position:sticky;top:0;z-index:2;padding:14px;background:var(--header);font-size:18px;font-weight:800;text-decoration:underline;border-bottom:1px solid var(--border);text-align:center}
    .col-body{flex:1;display:flex;flex-direction:column;overflow-y:auto;padding:10px;gap:8px}

    .task,.item{background:#fff;border:1px solid var(--border);border-left:10px solid var(--border);border-radius:10px;padding:12px;box-shadow:0 2px 6px rgba(2,6,23,.06)}
    .task.overdue{border-left-color:var(--late);animation:blink 1.6s ease-in-out infinite,jitter .6s linear infinite}
    .task.block{border-left-color:var(--block)}
    .task.exec{border-left-color:var(--exec)}
    .task.done{border-left-color:var(--ok)}
    .item.recv{border-left-color:var(--recv)}

    .title{font-weight:800;margin-bottom:6px}
    .meta{font-size:13px;color:var(--muted)}
    .chip{display:inline-block;background:var(--chip);padding:2px 8px;border-radius:999px;font-size:12px;font-weight:700;margin-left:6px}

    .adder{background:#f8fafc;border:1px dashed var(--border);border-radius:10px;padding:10px;display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    .adder input,.adder select{border:1px solid var(--border);border-radius:8px;padding:6px 8px}

    .section{margin-top:6px;padding-top:6px;border-top:1px dashed var(--border)}
    .section h3{margin:8px 0 6px;font-size:14px;color:#0f172a;text-align:center}

    @keyframes blink{0%{opacity:1}50%{opacity:.45}100%{opacity:1}}
    @keyframes jitter{0%,100%{transform:translateX(0)}25%{transform:translateX(1px)}75%{transform:translateX(-1px)}}

    /* Modal Histórico */
    .modal{position:fixed;inset:0;background:rgba(15,23,42,.5);display:none;align-items:center;justify-content:center;padding:20px}
    .modal-card{background:#fff;border-radius:12px;border:1px solid var(--border);max-width:900px;width:100%;max-height:80vh;overflow:auto;padding:16px}
    .modal h3{margin:0 0 10px 0}
    .history-item{padding:8px;border-bottom:1px solid #e5e7eb;font-size:14px}
    .modal .close{float:right}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo-box"><img id="logo" class="logo-img" alt="Logo System Engenharia"/><div id="logoPh" class="logo-ph">LOGO</div></div>
      <h1>Atlântico Golf — Quadro Kanban (Semanal)</h1>
    </div>
    <div class="right">
      <button id="resetBtn" class="btn" title="Limpar semana (mantém histórico)">🧹 Reset Semana</button>
      <button id="histBtn" class="btn" title="Ver histórico">📜 Histórico</button>
      <div class="clock" id="clock">--:--:--</div>
    </div>
  </header>

  <div class="board" id="board"></div>

  <!-- Modal Histórico -->
  <div id="histModal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-card">
      <button id="histClose" class="btn close">✖ Fechar</button>
      <h3>Histórico de Movimentações</h3>
      <div id="histList"></div>
    </div>
  </div>

  <script>
  (function(){
    'use strict';

    var STATE_VERSION='v11-2025-09-14';
    var STORAGE_KEY='atlGolfState';
    var STORAGE_VER='atlGolfStateVersion';
    var HIST_KEY='atlGolfHistory';

    var DATA_DEFAULT={
      logo_src:'assets/logo.jpg',
      encarregados:[
        {nome:'Severo (Hidráulica)',tarefas:[{titulo:'Interligar barrilete Torre 1 — Subsolo',prazo:'16/09/2025',status:'exec'}]},
        {nome:'Ayrton (Hidráulica)',tarefas:[{titulo:'Fixar suportes de reservatórios — Área Técnica',prazo:'15/09/2025',status:'done'}]},
        {nome:'Thiago (Elétrica)',tarefas:[{titulo:'Lançamento cabos QGBT→QDLs — Subsolo',prazo:'16/09/2025',status:'exec'}]},
        {nome:'Marcelo (Elétrica)',tarefas:[{titulo:'Checklist iluminação emergência — Térreo',prazo:'18/09/2025',status:'exec'}]}
      ],
      suprimentos:{
        requisicoes:[{numero:'RQ-241',data:'12/09/2025',prazo:'18/09/2025',status:'EM ANÁLISE'}],
        ocs:[{numero:'OC-1189',emissao:'14/09/2025',fornecedor:'Prysmian',status:'EMITIDA',previsao:'18/09/2025',comprador:'Carla',recebido:''}]
      }
    };

    var DATA=loadState();
    var HISTORY=loadHistory();

    function loadState(){ try{ var ver=localStorage.getItem(STORAGE_VER); var raw=localStorage.getItem(STORAGE_KEY); if(!raw||ver!==STATE_VERSION) return clone(DATA_DEFAULT); return JSON.parse(raw);}catch(e){return clone(DATA_DEFAULT);} }
    function saveState(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(DATA)); localStorage.setItem(STORAGE_VER, STATE_VERSION);}catch(e){} }
    function loadHistory(){ try{ var raw=localStorage.getItem(HIST_KEY); return raw?JSON.parse(raw):[];}catch(e){return [];} }
    function saveHistory(){ try{ localStorage.setItem(HIST_KEY, JSON.stringify(HISTORY)); }catch(e){} }
    function clone(o){ return JSON.parse(JSON.stringify(o)); }

    var DAY=86400000, HOUR=36e5;
    function parseBRDate(s){ if(!s) return null; var p=s.split('/'); if(p.length!=3) return null; var d=+p[0],m=+p[1],y=+p[2]; var dt=new Date(y,m-1,d,12,0,0); return isNaN(dt)?null:dt; }
    function diffDays(a,b){ return Math.round((a-b)/DAY); }
    function diffHours(a,b){ return (a-b)/HOUR; }
    function pad2(n){ return String(n).padStart(2,'0'); }
    function dLabel(dateStr){ var d=parseBRDate(dateStr); if(!d) return ''; var delta=Math.floor((d - new Date())/DAY); if(delta===0) return 'D-0'; return delta>0?('D-'+delta):('D+'+Math.abs(delta)); }
    function urgency(dateStr,status){ if(status==='done')return'done'; if(status==='block')return'block'; if(status==='exec')return'exec'; var d=parseBRDate(dateStr); if(!d) return 'ok'; var dh=diffHours(d,new Date()); if(dh<=0)return'overdue'; if(dh<=48)return'soon'; return'ok'; }

    function labelStatus(st,cls){ if(st==='exec')return'Em execução'; if(st==='block')return'Bloqueada'; if(st==='done')return'Finalizada 🏆'; if(cls==='overdue')return'Atrasada'; return'Pendente'; }
    function toISO(br){ if(!br) return ''; var p=br.split('/'); if(p.length!==3) return ''; return p[2]+'-'+pad2(p[1])+'-'+pad2(p[0]); }
    function fromISO(iso){ if(!iso) return ''; var p=iso.split('-'); if(p.length!==3) return ''; return pad2(p[2])+'/'+pad2(p[1])+'/'+p[0]; }

    function el(tag,cls,txt){ var e=document.createElement(tag); if(cls) e.className=cls; if(txt!=null) e.textContent=txt; return e; }
    function addOpt(sel,val,txt,selb){ var o=document.createElement('option'); o.value=val; o.textContent=txt; if(selb) o.selected=true; sel.appendChild(o); }

    var boardEl=document.getElementById('board');

    function render(){
      boardEl.innerHTML='';

      // Colunas de encarregados com rolagem independente
      for(var i=0;i<DATA.encarregados.length;i++){
        var enc=DATA.encarregados[i];
        var col=el('section','column');
        col.appendChild(el('div','col-header',enc.nome));
        var body=el('div','col-body');

        // Formulário de adição (completo)
        var ad=el('div','adder');
        var tInput=document.createElement('input'); tInput.placeholder='Atividade'; tInput.size=28;
        var dateInput=document.createElement('input'); dateInput.type='date';
        var stSel=document.createElement('select'); addOpt(stSel,'exec','Em execução',true); addOpt(stSel,'block','Bloqueada'); addOpt(stSel,'done','Finalizada');
        var addBtn=el('button','btn','➕ Incluir');
        ad.appendChild(tInput); ad.appendChild(dateInput); ad.appendChild(stSel); ad.appendChild(addBtn);
        (function(encIdx){ addBtn.addEventListener('click',function(){ var tit=tInput.value.trim(); if(!tit){alert('Informe o título'); return;} var pr=fromISO(dateInput.value); var st=stSel.value; DATA.encarregados[encIdx].tarefas.push({titulo:tit,prazo:pr,status:st}); saveState(); pushHist('Tarefa','Nova', DATA.encarregados[encIdx].nome, tit, (pr||'-')+' • '+st); tInput.value=''; dateInput.value=''; stSel.value='exec'; render(); }); })(i);
        body.appendChild(ad);

        // Cards
        for(var j=0;j<enc.tarefas.length;j++){
          var t=enc.tarefas[j];
          var cls=urgency(t.prazo,t.status);
          var card=el('div','task '+cls);
          var ttl=el('div','title', t.titulo);
          var mt=el('div','meta','Prazo: '+(t.prazo||'-')+' • '+dLabel(t.prazo));
          var chip=el('span','chip',labelStatus(t.status,cls));
          mt.appendChild(chip);
          card.appendChild(ttl); card.appendChild(mt);

          // Edit inline
          var ctr=el('div','adder');
          var eDate=document.createElement('input'); eDate.type='date'; eDate.value=toISO(t.prazo);
          var eSel=document.createElement('select'); addOpt(eSel,'exec','Em execução',t.status==='exec'); addOpt(eSel,'block','Bloqueada',t.status==='block'); addOpt(eSel,'done','Finalizada',t.status==='done');
          var eSave=el('button','btn','💾 Salvar');
          var eDel=el('button','btn','🗑️ Remover');
          ctr.appendChild(eDate); ctr.appendChild(eSel); ctr.appendChild(eSave); ctr.appendChild(eDel);
          (function(encIdx,taskIdx){
            eSave.addEventListener('click',function(){ var old=clone(DATA.encarregados[encIdx].tarefas[taskIdx]); DATA.encarregados[encIdx].tarefas[taskIdx].prazo=fromISO(eDate.value); DATA.encarregados[encIdx].tarefas[taskIdx].status=eSel.value; saveState(); pushHist('Tarefa','Editar', DATA.encarregados[encIdx].nome, old.titulo, old.prazo+'/' + old.status + ' → ' + (fromISO(eDate.value)||'-')+'/'+eSel.value); render(); });
            eDel.addEventListener('click',function(){ if(confirm('Remover tarefa?')){ var del=DATA.encarregados[encIdx].tarefas.splice(taskIdx,1)[0]; saveState(); pushHist('Tarefa','Remover', DATA.encarregados[encIdx].nome, del.titulo, del.prazo||'-'); render(); }});
          })(i,j);

          body.appendChild(card); body.appendChild(ctr);
        }

        col.appendChild(body); boardEl.appendChild(col);
      }

      // Suprimentos (coluna com rolagem própria)
      var sup=el('section','column');
      sup.appendChild(el('div','col-header','Suprimentos'));
      var sb=el('div','col-body');

      // RQs
      var rqTitle=el('div','section'); rqTitle.appendChild(el('h3','', 'Requisições em Aberto'));
      sb.appendChild(rqTitle);
      for(var r=0;r<DATA.suprimentos.requisicoes.length;r++){
        var rq=DATA.suprimentos.requisicoes[r];
        var dtP=parseBRDate(rq.prazo), dtS=parseBRDate(rq.data); var lt = (dtP&&dtS)? (diffDays(dtP,dtS)+'d'):'-';
        var it=el('div','item '+urgency(rq.prazo, rq.status));
        it.appendChild(el('div','title', rq.numero+' — '+(rq.status||'')));
        it.appendChild(el('div','meta','Data: '+(rq.data||'-')+' • Prazo: '+(rq.prazo||'-')+' • Lead time esperado: '+lt));
        // editor
        var rqCtr=el('div','adder');
        var rqD=document.createElement('input'); rqD.type='date'; rqD.value=toISO(rq.data);
        var rqP=document.createElement('input'); rqP.type='date'; rqP.value=toISO(rq.prazo);
        var rqS=document.createElement('input'); rqS.placeholder='Status'; rqS.value=rq.status||'';
        var rqSave=el('button','btn','💾 Salvar'); var rqDel=el('button','btn','🗑️ Remover');
        rqCtr.appendChild(rqD); rqCtr.appendChild(rqP); rqCtr.appendChild(rqS); rqCtr.appendChild(rqSave); rqCtr.appendChild(rqDel);
        (function(idx){ rqSave.addEventListener('click',function(){ DATA.suprimentos.requisicoes[idx].data=fromISO(rqD.value); DATA.suprimentos.requisicoes[idx].prazo=fromISO(rqP.value); DATA.suprimentos.requisicoes[idx].status=rqS.value.trim(); saveState(); pushHist('Requisição','Editar', DATA.suprimentos.requisicoes[idx].numero, '', 'Atualizado'); render(); }); rqDel.addEventListener('click',function(){ if(confirm('Remover RQ?')){ var del=DATA.suprimentos.requisicoes.splice(idx,1)[0]; saveState(); pushHist('Requisição','Remover', del.numero, '', '—'); render(); }}); })(r);
        sb.appendChild(it); sb.appendChild(rqCtr);
      }
      // Adder RQ
      var newRq=el('div','adder');
      var rqNum=document.createElement('input'); rqNum.placeholder='RQ-xxxx';
      var rqDate=document.createElement('input'); rqDate.type='date';
      var rqPrazo=document.createElement('input'); rqPrazo.type='date';
      var rqStatus=document.createElement('input'); rqStatus.placeholder='Status';
      var rqAdd=el('button','btn','➕ Incluir RQ');
      newRq.appendChild(rqNum); newRq.appendChild(rqDate); newRq.appendChild(rqPrazo); newRq.appendChild(rqStatus); newRq.appendChild(rqAdd);
      rqAdd.addEventListener('click',function(){ if(!rqNum.value.trim()){alert('Informe RQ');return;} DATA.suprimentos.requisicoes.push({numero:rqNum.value.trim(), data:fromISO(rqDate.value), prazo:fromISO(rqPrazo.value), status:rqStatus.value.trim()}); saveState(); pushHist('Requisição','Nova', rqNum.value.trim(), '', '—'); render(); });
      sb.appendChild(newRq);

      // OCs
      var ocTitle=el('div','section'); ocTitle.appendChild(el('h3','', 'Ordens de Compra (OC)'));
      sb.appendChild(ocTitle);
      for(var o=0;o<DATA.suprimentos.ocs.length;o++){
        var oc=DATA.suprimentos.ocs[o];
        var dtR=parseBRDate(oc.recebido), dtE=parseBRDate(oc.emissao); var ltR=(dtR&&dtE)? (diffDays(dtR,dtE)+'d'):'-';
        var it2=el('div','item '+(oc.recebido?'recv':urgency(oc.previsao, oc.status)));
        it2.appendChild(el('div','title', oc.numero+' — '+(oc.status||'')));
        it2.appendChild(el('div','meta', 'Emissão: '+(oc.emissao||'-')+' • Previsão: '+(oc.previsao||'-')+' • Lead time real: '+ltR));
        it2.appendChild(el('div','meta', oc.fornecedor? ('Fornecedor: '+oc.fornecedor+' • Comprador: '+(oc.comprador||'-')): ''));
        it2.appendChild(el('div','meta', oc.recebido? ('Recebido em '+oc.recebido): 'Pendente'));
        // editor
        var ocCtr=el('div','adder');
        var e1=document.createElement('input'); e1.type='date'; e1.value=toISO(oc.emissao);
        var e2=document.createElement('input'); e2.type='date'; e2.value=toISO(oc.previsao);
        var e3=document.createElement('input'); e3.type='date'; e3.value=toISO(oc.recebido);
        var eS=document.createElement('input'); eS.placeholder='Status'; eS.value=oc.status||'';
        var eF=document.createElement('input'); eF.placeholder='Fornecedor'; eF.value=oc.fornecedor||'';
        var eC=document.createElement('input'); eC.placeholder='Comprador'; eC.value=oc.comprador||'';
        var ocSave=el('button','btn','💾 Salvar'); var ocDel=el('button','btn','🗑️ Remover');
        ocCtr.appendChild(e1); ocCtr.appendChild(e2); ocCtr.appendChild(e3); ocCtr.appendChild(eS); ocCtr.appendChild(eF); ocCtr.appendChild(eC); ocCtr.appendChild(ocSave); ocCtr.appendChild(ocDel);
        (function(idx){ ocSave.addEventListener('click',function(){ var rec=fromISO(e3.value); DATA.suprimentos.ocs[idx].emissao=fromISO(e1.value); DATA.suprimentos.ocs[idx].previsao=fromISO(e2.value); DATA.suprimentos.ocs[idx].recebido=rec; DATA.suprimentos.ocs[idx].status=eS.value.trim(); DATA.suprimentos.ocs[idx].fornecedor=eF.value.trim(); DATA.suprimentos.ocs[idx].comprador=eC.value.trim(); saveState(); pushHist('OC','Editar', DATA.suprimentos.ocs[idx].numero, '', 'Atualizado'); render(); }); ocDel.addEventListener('click',function(){ if(confirm('Remover OC?')){ var del=DATA.suprimentos.ocs.splice(idx,1)[0]; saveState(); pushHist('OC','Remover', del.numero, '', '—'); render(); }}); })(o);
        sb.appendChild(it2); sb.appendChild(ocCtr);
      }
      // Adder OC
      var newOc=el('div','adder');
      var nNum=document.createElement('input'); nNum.placeholder='OC-xxxx';
      var nEmi=document.createElement('input'); nEmi.type='date';
      var nPrev=document.createElement('input'); nPrev.type='date';
      var nRec=document.createElement('input'); nRec.type='date';
      var nSta=document.createElement('input'); nSta.placeholder='Status';
      var nF=document.createElement('input'); nF.placeholder='Fornecedor';
      var nC=document.createElement('input'); nC.placeholder='Comprador';
      var nAdd=el('button','btn','➕ Incluir OC');
      newOc.appendChild(nNum); newOc.appendChild(nEmi); newOc.appendChild(nPrev); newOc.appendChild(nRec); newOc.appendChild(nSta); newOc.appendChild(nF); newOc.appendChild(nC); newOc.appendChild(nAdd);
      nAdd.addEventListener('click',function(){ if(!nNum.value.trim()){alert('Informe OC');return;} DATA.suprimentos.ocs.push({numero:nNum.value.trim(), emissao:fromISO(nEmi.value), previsao:fromISO(nPrev.value), recebido:fromISO(nRec.value), status:nSta.value.trim(), fornecedor:nF.value.trim(), comprador:nC.value.trim()}); saveState(); pushHist('OC','Nova', nNum.value.trim(), '', '—'); render(); });
      sb.appendChild(newOc);

      sup.appendChild(sb); boardEl.appendChild(sup);

      // Clock
      document.getElementById('clock').textContent = (function(){ var t=new Date(); return pad2(t.getHours())+':'+pad2(t.getMinutes())+':'+pad2(t.getSeconds()); })();
    }

    function pushHist(tipo,campo,contexto,titulo,valor){ var t=new Date(); HISTORY.unshift({ts:t.toISOString(),tipo:tipo,campo:campo,contexto:contexto,titulo:titulo,valor:valor}); if(HISTORY.length>800) HISTORY.pop(); saveHistory(); }

    function openHistory(){ var list=document.getElementById('histList'); var modal=document.getElementById('histModal'); list.innerHTML=''; for(var i=0;i<HISTORY.length;i++){ var h=HISTORY[i], d=new Date(h.ts); var line=el('div','history-item','['+pad2(d.getDate())+'/'+pad2(d.getMonth()+1)+'/'+d.getFullYear()+' '+pad2(d.getHours())+':'+pad2(d.getMinutes())+'] '+h.tipo+' • '+h.campo+' • '+(h.contexto||'')+' • '+(h.titulo||'')+' → '+h.valor); list.appendChild(line);} modal.style.display='flex'; }
    function closeHistory(){ document.getElementById('histModal').style.display='none'; }

    document.getElementById('histBtn').addEventListener('click', openHistory);
    document.getElementById('histClose').addEventListener('click', closeHistory);
    document.getElementById('histModal').addEventListener('click', function(e){ if(e.target===this) closeHistory(); });

    document.getElementById('resetBtn').addEventListener('click', function(){ if(confirm('Limpar dados atuais? Histórico será mantido.')){ DATA=clone(DATA_DEFAULT); saveState(); render(); initLogo(); pushHist('Sistema','Reset Semana','—','—','Dados retornados ao padrão'); }});

    function initLogo(){ var img=document.getElementById('logo'); var ph=document.getElementById('logoPh'); var src=DATA.logo_src||''; if(!src){ img.style.display='none'; ph.style.display='flex'; return; } img.onload=function(){ img.style.display='block'; ph.style.display='none'; }; img.onerror=function(){ img.style.display='none'; ph.style.display='flex'; }; img.src=src; }

    document.addEventListener('DOMContentLoaded', function(){ initLogo(); render(); setInterval(render, 1000); });
  })();
  </script>
</body>
</html>


