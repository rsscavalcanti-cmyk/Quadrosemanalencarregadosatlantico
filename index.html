<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AtlÃ¢ntico Golf â€” Quadro Kanban por Encarregado</title>
  <meta name="description" content="VisualizaÃ§Ã£o Kanban por encarregado + Suprimentos, com cÃ³digos numÃ©ricos Ãºnicos por processo (tarefas, requisiÃ§Ãµes e OCs). Sem ediÃ§Ã£o via UI." />
  <style>
    :root{
      --bg:#f5f7fb; --text:#111827; --muted:#475569; --brand:#005b96;
      --card:#ffffff; --border:#cbd5e1; --header:#f1f5f9;
      --ok:#16a34a; --warn:#ca8a04; --late:#b91c1c; --block:#9333ea; --exec:#0ea5e9; --recv:#15803d;
      --chip:#e2e8f0; --mono:#0f172a;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Arial,sans-serif;background:var(--bg);color:var(--text)}

    header{padding:14px 16px;background:var(--brand);color:#fff;display:flex;justify-content:space-between;align-items:center}
    .brand{display:flex;align-items:center;gap:14px}
    .logo-box{width:160px;height:70px;background:#fff;border-radius:10px;border:2px solid rgba(255,255,255,.25);display:flex;align-items:center;justify-content:center;overflow:hidden}
    .logo-img{max-width:100%;max-height:100%;display:none}
    .logo-ph{width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#0f172a;font-weight:800;letter-spacing:.3px}
    h1{margin:0;font-size:24px}
    .clock{font-variant-numeric:tabular-nums}

    .board{display:flex;align-items:flex-start;gap:16px;padding:16px;overflow:auto;height:calc(100% - 92px)}
    .column{background:var(--card);border:1px solid var(--border);border-radius:10px;min-width:300px;max-width:460px;flex:1;display:flex;flex-direction:column}
    .column h2{margin:0;padding:14px;background:var(--header);font-size:18px;font-weight:800;text-decoration:underline;border-bottom:1px solid var(--border);text-align:center}

    .list{padding:10px}
    .task{background:#ffffff;margin:8px 0;border:1px solid var(--border);border-left:10px solid var(--border);border-radius:10px;padding:12px;box-shadow:0 2px 6px rgba(2,6,23,.06);position:relative;transition:transform .18s ease, box-shadow .18s ease}
    .task.overdue{border-left-color:var(--late);animation:blink 1.6s ease-in-out infinite, jitter .6s linear infinite;transform:scale(1.02);box-shadow:0 6px 16px rgba(185,28,28,.18)}
    .task.block{border-left-color:var(--block)}
    .task.exec{border-left-color:var(--exec)}
    .task.done{border-left-color:var(--ok)}
    .title{font-weight:800;margin-bottom:6px}
    .meta{font-size:13px;color:var(--muted)}
    .chip{display:inline-block;background:var(--chip);padding:2px 8px;border-radius:999px;font-size:12px;font-weight:700;margin-left:6px}
    .code{display:inline-block;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:12px;background:#eef2ff;color:var(--mono);border:1px solid #c7d2fe;padding:2px 6px;border-radius:6px;margin-right:6px}

    .section{margin-top:6px;padding-top:6px;border-top:1px dashed var(--border)}
    .section h3{margin:8px 0 6px;font-size:14px;color:#0f172a;text-align:center}
    .item{background:#ffffff;border:1px solid var(--border);border-left:8px solid var(--border);border-radius:10px;padding:10px;margin:8px 0;box-shadow:0 2px 6px rgba(2,6,23,.06);position:relative;transition:transform .18s ease, box-shadow .18s ease}
    .item.overdue{border-left-color:var(--late);transform:scale(1.02);box-shadow:0 6px 16px rgba(185,28,28,.18)}
    .item.soon{border-left-color:var(--warn)}
    .item.ok{border-left-color:var(--ok)}
    .item.recv{border-left-color:var(--recv)}
    .row{display:flex;justify-content:space-between;gap:8px;font-size:14px}
    .kv{font-size:12px;color:var(--muted)}

    @keyframes blink{0%{opacity:1}50%{opacity:.45}100%{opacity:1}}
    @keyframes jitter{0%,100%{transform:translateX(0)}25%{transform:translateX(1px)}75%{transform:translateX(-1px)}}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo-box"><img id="logo" class="logo-img" alt="Logo System Engenharia" /><div id="logoPh" class="logo-ph">LOGO</div></div>
      <h1>AtlÃ¢ntico Golf â€” Quadro Kanban (Semanal)</h1>
    </div>
    <div class="clock" id="clock">--:--:--</div>
  </header>

  <div class="board" id="board"></div>

  <script>
  (function(){
    'use strict';

    /* =================== DADOS (edite aqui no cÃ³digo) =================== */
    // Regras de cÃ³digo:
    // - Tarefas: cÃ³digo "T-0001", "T-0002", ... gerado na ordem de criaÃ§Ã£o (global).
    //   VocÃª pode definir manualmente: { codigo:'T-0015', ... }
    // - RequisiÃ§Ãµes: se tiver "codigo" usa ele; senÃ£o, usa o campo "numero" como cÃ³digo.
    // - OCs: idem, se nÃ£o houver "codigo", usa "numero".

    var DATA = {
      logo_src: 'assets/logo.jpg',
      encarregados:[
        {nome:'Severo (HidrÃ¡ulica)', tarefas:[
          {codigo:'', titulo:'Interligar barrilete Torre 1 â€” Subsolo', prazo:'16/09/2025', status:'exec'},
          {codigo:'', titulo:'Teste estanqueidade prumada A â€” Bloco 2', prazo:'17/09/2025', status:'block'}
        ]},
        {nome:'Ayrton (HidrÃ¡ulica)', tarefas:[
          {codigo:'', titulo:'Fixar suportes de reservatÃ³rios â€” Ãrea TÃ©cnica', prazo:'15/09/2025', status:'done', finalizado_em:'15/09/2025'},
          {codigo:'', titulo:'Montar barrilete superior â€” Torre 3', prazo:'19/09/2025', status:'exec'}
        ]},
        {nome:'Thiago (ElÃ©trica)', tarefas:[
          {codigo:'', titulo:'LanÃ§amento cabos QGBTâ†’QDLs â€” Subsolo', prazo:'16/09/2025', status:'exec'},
          {codigo:'', titulo:'Fechamento alimentadores nos disjuntores gerais', prazo:'17/09/2025', status:'block'}
        ]},
        {nome:'Marcelo (ElÃ©trica)', tarefas:[
          {codigo:'', titulo:'RevisÃ£o SPDA â€” Cobertura Bloco 2', prazo:'15/09/2025', status:'done', finalizado_em:'15/09/2025'},
          {codigo:'', titulo:'Checklist iluminaÃ§Ã£o emergÃªncia â€” TÃ©rreo', prazo:'18/09/2025', status:'exec'}
        ]}
      ],
      suprimentos:{
        requisicoes:[
          {codigo:'', numero:'RQ-241', data:'12/09/2025', solicitante:'Thiago', area:'Subsolo', status:'EM ANÃLISE', obs:'Eletrocalhas 100mm', prazo:'18/09/2025'},
          {codigo:'', numero:'RQ-256', data:'13/09/2025', solicitante:'Severo', area:'HidrÃ¡ulica', status:'APROVADA', obs:'ConexÃµes PPR Ã˜75', prazo:'20/09/2025'}
          // Para finalizar e fazer "subir": status: 'FINALIZADA' e (opcional) finalizado_em:'dd/mm/aaaa'
        ],
        ocs:[
          {codigo:'', numero:'OC-1189', emissao:'14/09/2025', fornecedor:'Prysmian', status:'EMITIDA', previsao:'18/09/2025', comprador:'Carla', recebido:''},
          {codigo:'', numero:'OC-1197', emissao:'17/09/2025', fornecedor:'Megabarre', status:'AGUARDANDO NF', previsao:'25/09/2025', comprador:'Eduardo', recebido:'26/09/2025'}
        ]
      }
    };

    /* =================== UTIL DE DATAS =================== */
    var DAY = 86400000, HOUR = 36e5;
    function parseBRDate(s){ if(!s) return null; var a=s.split('/'); if(a.length!==3) return null; var d=+a[0], m=+a[1], y=+a[2]; var dt=new Date(y, m-1, d, 12, 0, 0); return isNaN(dt)?null:dt; }
    function diffDays(a,b){ return Math.round((a-b)/DAY); }
    function fmtClock(){ var t=new Date(); var pad=n=>String(n).padStart(2,'0'); return pad(t.getHours())+':'+pad(t.getMinutes())+':'+pad(t.getSeconds()); }
    function dLabel(dateStr){ var d=parseBRDate(dateStr); if(!d) return ''; var delta = Math.floor((d - new Date())/DAY); if(delta===0) return 'D-0'; return (delta>0)?('D-'+delta):('D+'+Math.abs(delta)); }
    function urgencyByDate(dateStr, status){
      if(status==='done' || status==='FINALIZADA') return 'done';
      if(status==='block') return 'block';
      if(status==='exec') return 'exec';
      if(status==='recebido') return 'recv';
      var d=parseBRDate(dateStr); if(!d) return 'ok';
      var hours=(d - new Date())/HOUR;
      if(hours<=0) return 'overdue';
      if(hours<=48) return 'soon';
      return 'ok';
    }

    /* =================== CÃ“DIGOS (IDs) =================== */
    // SequÃªncia numÃ©rica global para tarefas (T-0001, T-0002, ...)
    var SEQ = 1; // se quiser iniciar em outro nÃºmero, altere aqui
    function nextTaskCode(){ var n=String(SEQ).padStart(4,'0'); SEQ++; return 'T-'+n; }
    function ensureCodes(){
      // Tarefas: percorre em ordem de declaraÃ§Ã£o e atribui cÃ³digo se estiver vazio
      for(var i=0;i<DATA.encarregados.length;i++){
        var ts = DATA.encarregados[i].tarefas||[];
        for(var j=0;j<ts.length;j++){
          if(!ts[j].codigo){ ts[j].codigo = nextTaskCode(); }
        }
      }
      // RequisiÃ§Ãµes: se nÃ£o houver codigo, usa numero
      var rqs = DATA.suprimentos.requisicoes||[];
      for(var r=0;r<rqs.length;r++){
        if(!rqs[r].codigo){ rqs[r].codigo = rqs[r].numero ? String(rqs[r].numero) : ('RQ-'+String(r+1).padStart(4,'0')); }
      }
      // OCs: se nÃ£o houver codigo, usa numero
      var ocs = DATA.suprimentos.ocs||[];
      for(var o=0;o<ocs.length;o++){
        if(!ocs[o].codigo){ ocs[o].codigo = ocs[o].numero ? String(ocs[o].numero) : ('OC-'+String(o+1).padStart(4,'0')); }
      }
    }

    /* ===== OrdenaÃ§Ã£o ===== */
    function weightStatus(status){ if(status==='done' || status==='FINALIZADA') return -2; return 0; }
    function weightUrgencyByDate(dateStr){ var d=parseBRDate(dateStr); if(!d) return 3; var hours=(d - new Date())/HOUR; if(hours<=0) return 0; if(hours<=48) return 1; return 2; }
    function compareByPrazo(a,b){
      var wa = weightStatus(a.status), wb = weightStatus(b.status);
      if(wa!==wb) return wa - wb;
      if((a.status==='done'||a.status==='FINALIZADA') && (b.status==='done'||b.status==='FINALIZADA')){
        var da=parseBRDate(a.finalizado_em||a.prazo||''), db=parseBRDate(b.finalizado_em||b.prazo||'');
        if(da && db) return db - da; if(da && !db) return -1; if(!da && db) return 1; return 0;
      }
      var ua = weightUrgencyByDate(a.prazo||a.previsao||a.data||'');
      var ub = weightUrgencyByDate(b.prazo||b.previsao||b.data||'');
      if(ua!==ub) return ua - ub;
      var da2=parseBRDate(a.prazo||a.previsao||a.data||'');
      var db2=parseBRDate(b.prazo||b.previsao||b.data||'');
      if(da2 && db2) return da2 - db2; if(da2 && !db2) return -1; if(!da2 && db2) return 1; return 0;
    }
    function compareOC(a,b){
      var ar = !!a.recebido, br = !!b.recebido;
      if(ar!==br) return br - ar;
      if(ar && br){ var da=parseBRDate(a.recebido), db=parseBRDate(b.recebido); if(da && db) return db - da; if(da && !db) return -1; if(!da && db) return 1; return 0; }
      return compareByPrazo({status:a.status, prazo:a.previsao},{status:b.status, prazo:b.previsao});
    }

    /* =================== DOM =================== */
    function el(tag, cls, text){ var e=document.createElement(tag); if(cls) e.className=cls; if(text!=null) e.textContent=text; return e; }
    var boardEl = document.getElementById('board');

    function render(){
      boardEl.innerHTML = '';

      // garante cÃ³digos
      ensureCodes();

      // === Colunas por Encarregado ===
      for(var i=0;i<DATA.encarregados.length;i++){
        var enc = DATA.encarregados[i];
        var tasks = (enc.tarefas||[]).slice().sort(compareByPrazo);

        var col = el('section','column');
        col.appendChild(el('h2','',enc.nome));
        var list = el('div','list');

        for(var j=0;j<tasks.length;j++){
          var t = tasks[j];
          var cls = urgencyByDate(t.prazo, t.status);
          var card = el('div','task '+cls);

          var code = el('span','code', '#'+(t.codigo||''));
          var title = el('span','title'); title.textContent = t.titulo;

          var header = el('div'); header.appendChild(code); header.appendChild(title);

          var meta = el('div','meta');
          var linha = [];
          if(t.status==='done' || t.status==='FINALIZADA'){
            linha.push(t.finalizado_em ? ('ConcluÃ­do: '+t.finalizado_em) : ('Prazo: '+(t.prazo||'-')));
          }else{
            linha.push('Prazo: '+(t.prazo||'-')+' â€¢ '+dLabel(t.prazo||''));
          }
          meta.textContent = linha.join(' ');

          var statusLabel = 'Pendente';
          if(t.status==='exec') statusLabel='Em execuÃ§Ã£o';
          else if(t.status==='block') statusLabel='Bloqueada';
          else if(t.status==='done' || t.status==='FINALIZADA') statusLabel='Finalizada ðŸ†';
          else if(cls==='overdue') statusLabel='Atrasada';
          var chip = el('span','chip',statusLabel);

          card.appendChild(header);
          card.appendChild(meta);
          meta.appendChild(chip);
          list.appendChild(card);
        }

        col.appendChild(list);
        boardEl.appendChild(col);
      }

      // === Coluna Suprimentos ===
      var sup = el('section','column');
      sup.appendChild(el('h2','','Suprimentos'));
      var sList = el('div','list');

      // RequisiÃ§Ãµes
      var rqSec = el('div','section');
      rqSec.appendChild(el('h3','', 'RequisiÃ§Ãµes em Aberto'));
      var rqs = (DATA.suprimentos.requisicoes||[]).slice().sort(function(a,b){
        return compareByPrazo(
          {status:a.status, prazo:a.prazo, finalizado_em:a.finalizado_em},
          {status:b.status, prazo:b.prazo, finalizado_em:b.finalizado_em}
        );
      });
      for(var r=0;r<rqs.length;r++){
        var rq = rqs[r];
        var dtPrazo = parseBRDate(rq.prazo); var dtData = parseBRDate(rq.data);
        var ltEsperado = (dtPrazo && dtData) ? (diffDays(dtPrazo, dtData)+'d') : '-';
        var clsRq = urgencyByDate(rq.prazo, rq.status);
        var it = el('div','item '+clsRq);

        var rowTop = el('div','row');
        var left = el('div'); left.appendChild(el('span','code','#'+(rq.codigo||'')));
        left.appendChild(el('strong','', rq.numero || rq.codigo || 'RQ'));
        rowTop.appendChild(left);
        rowTop.appendChild(el('span','', rq.status||''));

        var kv1 = el('div','kv','Data: '+(rq.data||'-')+' â€¢ Prazo: '+(rq.prazo||'-')+' â€¢ Lead time esperado: '+ltEsperado);
        var kv2 = el('div','kv','Solicitante: '+(rq.solicitante||'-')+' â€¢ Ãrea: '+(rq.area||'-')+' â€¢ Obs.: '+(rq.obs||'-'));

        it.appendChild(rowTop); it.appendChild(kv1); it.appendChild(kv2);
        rqSec.appendChild(it);
      }
      sList.appendChild(rqSec);

      // OCs
      var ocSec = el('div','section');
      ocSec.appendChild(el('h3','', 'Ordens de Compra (OC)'));
      var ocs = (DATA.suprimentos.ocs||[]).slice().sort(compareOC);
      for(var o=0;o<ocs.length;o++){
        var oc = ocs[o];
        var dtRec = parseBRDate(oc.recebido); var dtEmi = parseBRDate(oc.emissao);
        var ltReal = (dtRec && dtEmi) ? (diffDays(dtRec, dtEmi)+'d') : '-';
        var clsOc = oc.recebido ? 'recv' : urgencyByDate(oc.previsao, oc.status);
        var it2 = el('div','item '+clsOc);

        var rowTop2 = el('div','row');
        var left2 = el('div'); left2.appendChild(el('span','code','#'+(oc.codigo||'')));
        left2.appendChild(el('strong','', oc.numero || oc.codigo || 'OC'));
        rowTop2.appendChild(left2);
        rowTop2.appendChild(el('span','', oc.status||''));

        var kv3 = el('div','kv','Fornecedor: '+(oc.fornecedor||'-')+' â€¢ Comprador: '+(oc.comprador||'-'));
        var kv4 = el('div','kv','EmissÃ£o: '+(oc.emissao||'-')+' â€¢ PrevisÃ£o: '+(oc.previsao||'-')+' â€¢ Lead time real: '+ltReal);
        var st = el('div','kv', oc.recebido? ('Recebido em '+oc.recebido) : 'Pendente');

        it2.appendChild(rowTop2); it2.appendChild(kv3); it2.appendChild(kv4); it2.appendChild(st);
        ocSec.appendChild(it2);
      }
      sList.appendChild(ocSec);

      sup.appendChild(sList); boardEl.appendChild(sup);
    }

    /* =================== LOGO & RELÃ“GIO =================== */
    function initLogo(){
      var img = document.getElementById('logo');
      var ph  = document.getElementById('logoPh');
      var src = DATA.logo_src || '';
      if(!src){ img.style.display='none'; ph.style.display='flex'; return; }
      img.onload = function(){ img.style.display='block'; ph.style.display='none'; };
      img.onerror = function(){ img.style.display='none'; ph.style.display='flex'; };
      img.src = src;
    }
    function tick(){ document.getElementById('clock').textContent = fmtClock(); }

    /* =================== BOOT =================== */
    document.addEventListener('DOMContentLoaded', function(){
      initLogo();
      render();
      setInterval(function(){ tick(); }, 1000);
      setInterval(function(){ render(); }, 60000);
    });
  })();
  </script>
</body>
</html>

