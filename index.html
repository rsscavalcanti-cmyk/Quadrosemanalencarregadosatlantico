<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Atl√¢ntico Golf ‚Äî Quadro Kanban por Encarregado</title>
  <meta name="description" content="Kanban semanal por encarregado com inclus√£o em massa de cards, rolagem independente, cabe√ßalhos fixos e exporta√ß√£o/importa√ß√£o de hist√≥rico e dados." />
  <style>
    :root{
      --bg:#f5f7fb; --text:#111827; --muted:#475569; --brand:#005b96;
      --card:#ffffff; --border:#cbd5e1; --header:#f1f5f9;
      --ok:#16a34a; --warn:#ca8a04; --late:#b91c1c; --block:#9333ea; --exec:#0ea5e9; --recv:#15803d;
      --chip:#e2e8f0; --soft:#f8fafc;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Arial,sans-serif;background:var(--bg);color:var(--text)}

    header{padding:12px 14px;background:var(--brand);color:#fff;display:flex;justify-content:space-between;align-items:center;gap:10px}
    .brand{display:flex;align-items:center;gap:14px}
    .logo-box{width:160px;height:70px;background:#fff;border-radius:10px;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .logo-img{max-width:100%;max-height:100%;display:none}
    .logo-ph{width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#0f172a;font-weight:800}
    h1{margin:0;font-size:22px}

    .right{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
    .btn{background:#fff;color:#0f172a;border:0;border-radius:999px;padding:8px 12px;font-weight:700;cursor:pointer}
    .btn.sec{background:#e2e8f0}
    .clock{font-variant-numeric:tabular-nums}

    .board{display:flex;gap:16px;padding:16px;height:calc(100% - 94px);overflow-x:auto}
    .column{background:var(--card);border:1px solid var(--border);border-radius:10px;min-width:360px;max-width:560px;flex:1;display:flex;flex-direction:column}
    .col-header{position:sticky;top:0;z-index:2;padding:14px;background:var(--header);font-size:18px;font-weight:800;text-decoration:underline;border-bottom:1px solid var(--border);text-align:center}
    .col-body{flex:1;display:flex;flex-direction:column;overflow-y:auto;padding:10px;gap:8px}

    .task,.item{background:#fff;border:1px solid var(--border);border-left:10px solid var(--border);border-radius:10px;padding:12px;box-shadow:0 2px 6px rgba(2,6,23,.06)}
    .task.overdue{border-left-color:var(--late);animation:blink 1.4s ease-in-out infinite,jitter .6s linear infinite}
    .task.block{border-left-color:var(--block)}
    .task.exec{border-left-color:var(--exec)}
    .task.done{border-left-color:var(--ok)}
    .item.recv{border-left-color:var(--recv)}
    .title{font-weight:800;margin-bottom:6px}
    .meta{font-size:13px;color:var(--muted)}
    .chip{display:inline-block;background:var(--chip);padding:2px 8px;border-radius:999px;font-size:12px;font-weight:700;margin-left:6px}

    .row{display:flex;gap:8px;flex-wrap:wrap}
    .field{border:1px solid var(--border);border-radius:8px;padding:6px 8px}

    .adder{background:var(--soft);border:1px dashed var(--border);border-radius:10px;padding:10px;display:flex;flex-direction:column;gap:8px}
    .adder .row{align-items:center}

    details.bulk{background:var(--soft);border:1px dashed var(--border);border-radius:10px;padding:8px}
    details.bulk summary{cursor:pointer;font-weight:800}
    textarea.bulk-input{width:100%;min-height:120px;border:1px solid var(--border);border-radius:8px;padding:8px;font-family:ui-monospace, SFMono-Regular, Menlo, monospace}
    .hint{font-size:12px;color:#334155}

    .section{margin-top:6px;padding-top:6px;border-top:1px dashed var(--border)}
    .section h3{margin:8px 0 6px;font-size:14px;color:#0f172a;text-align:center}

    @keyframes blink{0%{opacity:1}50%{opacity:.45}100%{opacity:1}}
    @keyframes jitter{0%,100%{transform:translateX(0)}25%{transform:translateX(1px)}75%{transform:translateX(-1px)}}

    /* Modal Hist√≥rico */
    .modal{position:fixed;inset:0;background:rgba(15,23,42,.5);display:none;align-items:center;justify-content:center;padding:20px}
    .modal-card{background:#fff;border-radius:12px;border:1px solid var(--border);max-width:980px;width:100%;max-height:80vh;overflow:auto;padding:16px}
    .modal h3{margin:0 0 10px 0}
    .history-item{padding:8px;border-bottom:1px solid #e5e7eb;font-size:14px}
    .modal .close{float:right}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo-box"><img id="logo" class="logo-img" alt="Logo System Engenharia"/><div id="logoPh" class="logo-ph">LOGO</div></div>
      <h1>Atl√¢ntico Golf ‚Äî Quadro Kanban (Semanal)</h1>
    </div>
    <div class="right">
      <button id="exportData" class="btn" title="Exportar dados (.json)">‚¨áÔ∏è Dados</button>
      <button id="exportHist" class="btn" title="Exportar hist√≥rico (.json)">‚¨áÔ∏è Hist√≥rico</button>
      <label class="btn sec" title="Importar .json"><input id="importFile" type="file" accept="application/json" style="display:none">‚¨ÜÔ∏è Importar</label>
      <button id="resetBtn" class="btn sec" title="Limpar semana (mant√©m hist√≥rico)">üßπ Reset Semana</button>
      <button id="histBtn" class="btn" title="Ver hist√≥rico">üìú Hist√≥rico</button>
      <div class="clock" id="clock">--:--:--</div>
    </div>
  </header>

  <div class="board" id="board"></div>

  <!-- Modal Hist√≥rico -->
  <div id="histModal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-card">
      <button id="histClose" class="btn close">‚úñ Fechar</button>
      <h3>Hist√≥rico de Movimenta√ß√µes</h3>
      <div id="histList"></div>
    </div>
  </div>

  <script>
  (function(){
    'use strict';

    var STATE_VERSION='v12-2025-09-14';
    var STORAGE_KEY='atlGolfState';
    var STORAGE_VER='atlGolfStateVersion';
    var HIST_KEY='atlGolfHistory';

    var DATA_DEFAULT={
      logo_src:'assets/logo.jpg',
      encarregados:[
        {nome:'Severo (Hidr√°ulica)',tarefas:[{titulo:'Interligar barrilete Torre 1 ‚Äî Subsolo',prazo:'16/09/2025',status:'exec'}]},
        {nome:'Ayrton (Hidr√°ulica)',tarefas:[{titulo:'Fixar suportes de reservat√≥rios ‚Äî √Årea T√©cnica',prazo:'15/09/2025',status:'done'}]},
        {nome:'Thiago (El√©trica)',tarefas:[{titulo:'Lan√ßamento cabos QGBT‚ÜíQDLs ‚Äî Subsolo',prazo:'16/09/2025',status:'exec'}]},
        {nome:'Marcelo (El√©trica)',tarefas:[{titulo:'Checklist ilumina√ß√£o emerg√™ncia ‚Äî T√©rreo',prazo:'18/09/2025',status:'exec'}]}
      ],
      suprimentos:{
        requisicoes:[{numero:'RQ-241',data:'12/09/2025',prazo:'18/09/2025',status:'EM AN√ÅLISE'}],
        ocs:[{numero:'OC-1189',emissao:'14/09/2025',fornecedor:'Prysmian',status:'EMITIDA',previsao:'18/09/2025',comprador:'Carla',recebido:''}]
      }
    };

    var DATA=loadState();
    var HISTORY=loadHistory();

    function loadState(){ try{ var ver=localStorage.getItem(STORAGE_VER); var raw=localStorage.getItem(STORAGE_KEY); if(!raw||ver!==STATE_VERSION) return clone(DATA_DEFAULT); return JSON.parse(raw);}catch(e){return clone(DATA_DEFAULT);} }
    function saveState(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(DATA)); localStorage.setItem(STORAGE_VER, STATE_VERSION);}catch(e){} }
    function loadHistory(){ try{ var raw=localStorage.getItem(HIST_KEY); return raw?JSON.parse(raw):[];}catch(e){return [];} }
    function saveHistory(){ try{ localStorage.setItem(HIST_KEY, JSON.stringify(HISTORY)); }catch(e){} }
    function clone(o){ return JSON.parse(JSON.stringify(o)); }

    var DAY=86400000, HOUR=36e5;
    function parseBRDate(s){ if(!s) return null; var p=s.split('/'); if(p.length!=3) return null; var d=+p[0],m=+p[1],y=+p[2]; var dt=new Date(y,m-1,d,12,0,0); return isNaN(dt)?null:dt; }
    function diffDays(a,b){ return Math.round((a-b)/DAY); }
    function diffHours(a,b){ return (a-b)/HOUR; }
    function pad2(n){ return String(n).padStart(2,'0'); }
    function dLabel(dateStr){ var d=parseBRDate(dateStr); if(!d) return ''; var delta=Math.floor((d - new Date())/DAY); if(delta===0) return 'D-0'; return delta>0?('D-'+delta):('D+'+Math.abs(delta)); }
    function urgency(dateStr,status){ if(status==='done')return'done'; if(status==='block')return'block'; if(status==='exec')return'exec'; var d=parseBRDate(dateStr); if(!d) return 'ok'; var dh=diffHours(d,new Date()); if(dh<=0)return'overdue'; if(dh<=48)return'soon'; return'ok'; }
    function labelStatus(st,cls){ if(st==='exec')return'Em execu√ß√£o'; if(st==='block')return'Bloqueada'; if(st==='done')return'Finalizada üèÜ'; if(cls==='overdue')return'Atrasada'; return'Pendente'; }
    function toISO(br){ if(!br) return ''; var p=br.split('/'); if(p.length!==3) return ''; return p[2]+'-'+pad2(p[1])+'-'+pad2(p[0]); }
    function fromISO(iso){ if(!iso) return ''; var p=iso.split('-'); if(p.length!==3) return ''; return pad2(p[2])+'/'+pad2(p[1])+'/'+p[0]; }

    var boardEl=document.getElementById('board');

    function render(){
      boardEl.innerHTML='';

      // Colunas de encarregados
      for(var i=0;i<DATA.encarregados.length;i++){
        var enc=DATA.encarregados[i];
        var col=document.createElement('section'); col.className='column';
        var head=document.createElement('div'); head.className='col-header'; head.textContent=enc.nome; col.appendChild(head);
        var body=document.createElement('div'); body.className='col-body';

        // Adi√ß√£o r√°pida (um card)
        var add=document.createElement('div'); add.className='adder';
        var tInput=mkInput('Atividade', 30);
        var dInput=document.createElement('input'); dInput.type='date'; dInput.className='field';
        var sSel=document.createElement('select'); sSel.className='field';
        addOpt(sSel,'exec','Em execu√ß√£o',true); addOpt(sSel,'block','Bloqueada'); addOpt(sSel,'done','Finalizada');
        var btn=document.createElement('button'); btn.className='btn'; btn.textContent='‚ûï Incluir';
        var row=document.createElement('div'); row.className='row'; row.appendChild(tInput); row.appendChild(dInput); row.appendChild(sSel); row.appendChild(btn);
        add.appendChild(row);

        (function(encIdx){ btn.addEventListener('click', function(){ doAddSingle(encIdx, tInput.value, fromISO(dInput.value), sSel.value); tInput.value=''; dInput.value=''; sSel.value='exec'; }); })(i);

        // Inclus√£o em massa (textarea)
        var bulk=document.createElement('details'); bulk.className='bulk';
        var sum=document.createElement('summary'); sum.textContent='‚ûï Incluir v√°rias atividades (colar lista)'; bulk.appendChild(sum);
        var hint=document.createElement('div'); hint.className='hint'; hint.innerHTML='Formato por linha: <b>T√≠tulo</b> | <b>DD/MM/AAAA</b> | <b>Status</b> (exec/block/done). Ex.:<br>Concretar laje L2 | 19/09/2025 | exec';
        var ta=document.createElement('textarea'); ta.className='bulk-input'; ta.placeholder='Uma atividade por linha...';
        var bulkBtn=document.createElement('button'); bulkBtn.className='btn'; bulkBtn.textContent='Adicionar em massa';
        bulk.appendChild(hint); bulk.appendChild(ta); bulk.appendChild(document.createElement('br')); bulk.appendChild(bulkBtn);

        (function(encIdx){ bulkBtn.addEventListener('click', function(){ doBulkAdd(encIdx, ta.value); ta.value=''; }); })(i);

        body.appendChild(add); body.appendChild(bulk);

        // Listagem de cards
        for(var j=0;j<enc.tarefas.length;j++){
          var t=enc.tarefas[j];
          var cls=urgency(t.prazo,t.status);
          var card=document.createElement('div'); card.className='task '+cls;
          var ttl=document.createElement('div'); ttl.className='title'; ttl.textContent=t.titulo;
          var mt=document.createElement('div'); mt.className='meta'; mt.textContent='Prazo: '+(t.prazo||'-')+' ‚Ä¢ '+dLabel(t.prazo);
          var chip=document.createElement('span'); chip.className='chip'; chip.textContent=labelStatus(t.status, cls); mt.appendChild(chip);
          card.appendChild(ttl); card.appendChild(mt);

          // Editor simples
          var ed=document.createElement('div'); ed.className='row';
          var eDate=document.createElement('input'); eDate.type='date'; eDate.className='field'; eDate.value=toISO(t.prazo);
          var eSel=document.createElement('select'); eSel.className='field'; addOpt(eSel,'exec','Em execu√ß√£o',t.status==='exec'); addOpt(eSel,'block','Bloqueada',t.status==='block'); addOpt(eSel,'done','Finalizada',t.status==='done');
          var eSave=document.createElement('button'); eSave.className='btn sec'; eSave.textContent='üíæ Salvar';
          var eDel=document.createElement('button'); eDel.className='btn sec'; eDel.textContent='üóë Remover';
          ed.appendChild(eDate); ed.appendChild(eSel); ed.appendChild(eSave); ed.appendChild(eDel);

          (function(encIdx,taskIdx){
            eSave.addEventListener('click', function(){ var old=clone(DATA.encarregados[encIdx].tarefas[taskIdx]); DATA.encarregados[encIdx].tarefas[taskIdx].prazo=fromISO(eDate.value); DATA.encarregados[encIdx].tarefas[taskIdx].status=eSel.value; saveState(); pushHist('Tarefa','Editar', DATA.encarregados[encIdx].nome, old.titulo, old.prazo+'/' + old.status + ' ‚Üí ' + (fromISO(eDate.value)||'-')+'/'+eSel.value); render(); });
            eDel.addEventListener('click', function(){ if(confirm('Remover tarefa?')){ var del=DATA.encarregados[encIdx].tarefas.splice(taskIdx,1)[0]; saveState(); pushHist('Tarefa','Remover', DATA.encarregados[encIdx].nome, del.titulo, del.prazo||'-'); render(); } });
          })(i,j);

          body.appendChild(card); body.appendChild(ed);
        }

        col.appendChild(body); boardEl.appendChild(col);
      }

      // Coluna Suprimentos (mantida, com rolagem pr√≥pria)
      var sup=document.createElement('section'); sup.className='column';
      var shead=document.createElement('div'); shead.className='col-header'; shead.textContent='Suprimentos'; sup.appendChild(shead);
      var sbody=document.createElement('div'); sbody.className='col-body';

      var rqTitle=document.createElement('div'); rqTitle.className='section'; var rqH=document.createElement('h3'); rqH.textContent='Requisi√ß√µes em Aberto'; rqTitle.appendChild(rqH); sbody.appendChild(rqTitle);
      for(var r=0;r<DATA.suprimentos.requisicoes.length;r++){
        var rq=DATA.suprimentos.requisicoes[r]; var dtP=parseBRDate(rq.prazo), dtS=parseBRDate(rq.data); var lt=(dtP&&dtS)? (diffDays(dtP,dtS)+'d'):'-';
        var it=document.createElement('div'); it.className='item '+urgency(rq.prazo, rq.status);
        var t1=document.createElement('div'); t1.className='title'; t1.textContent=rq.numero+' ‚Äî '+(rq.status||'');
        var m1=document.createElement('div'); m1.className='meta'; m1.textContent='Data: '+(rq.data||'-')+' ‚Ä¢ Prazo: '+(rq.prazo||'-')+' ‚Ä¢ Lead time esperado: '+lt;
        it.appendChild(t1); it.appendChild(m1);
        sbody.appendChild(it);
      }

      var ocTitle=document.createElement('div'); ocTitle.className='section'; var ocH=document.createElement('h3'); ocH.textContent='Ordens de Compra (OC)'; ocTitle.appendChild(ocH); sbody.appendChild(ocTitle);
      for(var o=0;o<DATA.suprimentos.ocs.length;o++){
        var oc=DATA.suprimentos.ocs[o]; var dtR=parseBRDate(oc.recebido), dtE=parseBRDate(oc.emissao); var ltR=(dtR&&dtE)? (diffDays(dtR,dtE)+'d'):'-';
        var it2=document.createElement('div'); it2.className='item '+(oc.recebido?'recv':urgency(oc.previsao, oc.status));
        var t2=document.createElement('div'); t2.className='title'; t2.textContent=oc.numero+' ‚Äî '+(oc.status||'');
        var m2=document.createElement('div'); m2.className='meta'; m2.textContent='Emiss√£o: '+(oc.emissao||'-')+' ‚Ä¢ Previs√£o: '+(oc.previsao||'-')+' ‚Ä¢ Lead time real: '+ltR;
        var m3=document.createElement('div'); m3.className='meta'; m3.textContent=oc.fornecedor? ('Fornecedor: '+oc.fornecedor+' ‚Ä¢ Comprador: '+(oc.comprador||'-')) : '';
        var m4=document.createElement('div'); m4.className='meta'; m4.textContent=oc.recebido? ('Recebido em '+oc.recebido) : 'Pendente';
        it2.appendChild(t2); it2.appendChild(m2); if(m3.textContent) it2.appendChild(m3); it2.appendChild(m4);
        sbody.appendChild(it2);
      }

      sup.appendChild(sbody); boardEl.appendChild(sup);

      // Rel√≥gio
      document.getElementById('clock').textContent = (function(){ var t=new Date(); return pad2(t.getHours())+':'+pad2(t.getMinutes())+':'+pad2(t.getSeconds()); })();
    }

    function mkInput(ph, size){ var i=document.createElement('input'); i.placeholder=ph; i.size=size||20; i.className='field'; return i; }
    function addOpt(sel,val,txt,selb){ var o=document.createElement('option'); o.value=val; o.textContent=txt; if(selb) o.selected=true; sel.appendChild(o); }

    function doAddSingle(encIdx, titulo, prazo, status){
      var tit=(titulo||'').trim(); if(!tit){ alert('Informe o t√≠tulo'); return; }
      var st=status||'exec'; var pr=(prazo||'').trim();
      DATA.encarregados[encIdx].tarefas.push({titulo:tit,prazo:pr,status:st});
      saveState(); pushHist('Tarefa','Nova', DATA.encarregados[encIdx].nome, tit, (pr||'-')+' ‚Ä¢ '+st); render();
    }

    function doBulkAdd(encIdx, text){
      if(!text) return; var lines=text.split(/\n|\r/); var added=0;
      for(var i=0;i<lines.length;i++){
        var ln=lines[i].trim(); if(!ln) continue;
        var parts=ln.split('|');
        var tit=(parts[0]||'').trim(); if(!tit) continue;
        var pr=(parts[1]||'').trim();
        var st=(parts[2]||'').trim().toLowerCase();
        if(st!=='exec'&&st!=='block'&&st!=='done') st='exec';
        DATA.encarregados[encIdx].tarefas.push({titulo:tit,prazo:pr,status:st});
        pushHist('Tarefa','Nova (massa)', DATA.encarregados[encIdx].nome, tit, (pr||'-')+' ‚Ä¢ '+st);
        added++;
      }
      if(added===0){ alert('Nenhuma linha v√°lida. Use: T√≠tulo | DD/MM/AAAA | status'); return; }
      saveState(); render();
    }

    // ===== Hist√≥rico =====
    function pushHist(tipo,campo,contexto,titulo,valor){ var t=new Date(); HISTORY.unshift({ts:t.toISOString(),tipo:tipo,campo:campo,contexto:contexto,titulo:titulo,valor:valor}); if(HISTORY.length>1500) HISTORY.pop(); saveHistory(); }
    function openHistory(){ var list=document.getElementById('histList'); var modal=document.getElementById('histModal'); list.innerHTML=''; for(var i=0;i<HISTORY.length;i++){ var h=HISTORY[i], d=new Date(h.ts); var line=document.createElement('div'); line.className='history-item'; line.textContent='['+pad2(d.getDate())+'/'+pad2(d.getMonth()+1)+'/'+d.getFullYear()+' '+pad2(d.getHours())+':'+pad2(d.getMinutes())+'] '+h.tipo+' ‚Ä¢ '+h.campo+' ‚Ä¢ '+(h.contexto||'')+' ‚Ä¢ '+(h.titulo||'')+' ‚Üí '+h.valor; list.appendChild(line);} modal.style.display='flex'; }
    function closeHistory(){ document.getElementById('histModal').style.display='none'; }

    // ===== Export/Import =====
    function download(filename, text){ var a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([text],{type:'application/json'})); a.download=filename; document.body.appendChild(a); a.click(); setTimeout(function(){ URL.revokeObjectURL(a.href); a.remove(); }, 0); }
    function exportData(){ var payload={version:STATE_VERSION,data:DATA}; download('atl-golf-dados-'+new Date().toISOString().slice(0,19).replace(/[:T]/g,'-')+'.json', JSON.stringify(payload,null,2)); }
    function exportHist(){ var payload={history:HISTORY}; download('atl-golf-historico-'+new Date().toISOString().slice(0,19).replace(/[:T]/g,'-')+'.json', JSON.stringify(payload,null,2)); }
    function importFile(file){ var r=new FileReader(); r.onload=function(){ try{ var obj=JSON.parse(r.result); if(obj.data){ DATA=obj.data; saveState(); } if(obj.history){ HISTORY=obj.history; saveHistory(); } render(); alert('Importado com sucesso.'); }catch(e){ alert('Arquivo inv√°lido.'); } }; r.readAsText(file); }

    // ===== Header bindings =====
    document.getElementById('histBtn').addEventListener('click', openHistory);
    document.getElementById('histClose').addEventListener('click', closeHistory);
    document.getElementById('histModal').addEventListener('click', function(e){ if(e.target===this) closeHistory(); });
    document.getElementById('resetBtn').addEventListener('click', function(){ if(confirm('Limpar dados atuais? O HIST√ìRICO ser√° mantido.')){ DATA=clone(DATA_DEFAULT); saveState(); render(); initLogo(); pushHist('Sistema','Reset Semana','‚Äî','‚Äî','Dados retornados ao padr√£o'); }});
    document.getElementById('exportData').addEventListener('click', exportData);
    document.getElementById('exportHist').addEventListener('click', exportHist);
    document.getElementById('importFile').addEventListener('change', function(){ if(this.files&&this.files[0]) importFile(this.files[0]); this.value=''; });

    // ===== Logo e Rel√≥gio =====
    function initLogo(){ var img=document.getElementById('logo'); var ph=document.getElementById('logoPh'); var src=DATA.logo_src||''; if(!src){ img.style.display='none'; ph.style.display='flex'; return; } img.onload=function(){ img.style.display='block'; ph.style.display='none'; }; img.onerror=function(){ img.style.display='none'; ph.style.display='flex'; }; img.src=src; }
    function tick(){ var t=new Date(); document.getElementById('clock').textContent=pad2(t.getHours())+':'+pad2(t.getMinutes())+':'+pad2(t.getSeconds()); }

    document.addEventListener('DOMContentLoaded', function(){ initLogo(); render(); setInterval(tick,1000); setInterval(render,60000); });
  })();
  </script>
</body>
</html>
