<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Atl√¢ntico Golf ‚Äî Quadro Kanban</title>
  <meta name="description" content="Kanban por encarregado + Suprimentos. T√≠tulos fixos e rolagem independente por coluna. C√≥digos √∫nicos por processo. % executado e atraso por tarefa." />
  <style>
    :root{
      --bg:#f5f7fb; --text:#111827; --muted:#475569; --brand:#0e3a6d;
      --brand2:#0b2a4a; --card:#ffffff; --border:#cbd5e1; --header:#f1f5f9;
      --ok:#16a34a; --warn:#ca8a04; --late:#b91c1c; --block:#9333ea; --exec:#0ea5e9; --recv:#15803d;
      --chip:#e2e8f0; --mono:#0f172a;
      --header-h: 112px; --footer-h: 0px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Arial,sans-serif;background:var(--bg);color:var(--text)}

    /* ===== Header fixo ===== */
    header{
      position:sticky;top:0;z-index:100;
      color:#fff;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;
      padding:14px 18px;box-shadow:0 2px 10px rgba(0,0,0,.18);
      background:linear-gradient(90deg,var(--brand2) 0%, var(--brand) 100%);
    }
    .brand{display:flex;align-items:center;gap:16px}
    .logo-box{width:164px;height:64px;background:#fff;border-radius:10px;border:2px solid rgba(255,255,255,.25);display:flex;align-items:center;justify-content:center;overflow:hidden}
    .logo-img{max-width:100%;max-height:100%;display:none}
    .logo-ph{width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#0f172a;font-weight:800;letter-spacing:.3px}
    h1{margin:0;font-size:24px;letter-spacing:.2px}
    .subtitle{margin-top:2px;font-size:13px;opacity:.9}

    .meta{ text-align:right; display:flex; flex-direction:column; gap:4px }
    .stamp{font-size:13px;font-weight:700}
    .clock{font-variant-numeric:tabular-nums;font-size:12px;opacity:.95}

    /* ===== Painel e colunas ===== */
    .board{height:calc(100vh - var(--header-h) - var(--footer-h));display:flex;gap:16px;padding:16px;overflow-x:auto;overflow-y:hidden}
    .column{background:var(--card);border:1px solid var(--border);border-radius:10px;min-width:320px;max-width:480px;flex:1;display:flex;flex-direction:column;height:100%;overflow:hidden}
    .column h2{position:sticky;top:0;z-index:10;margin:0;padding:12px;background:var(--header);font-size:18px;font-weight:800;text-decoration:underline;border-bottom:1px solid var(--border);text-align:center;box-shadow:0 1px 0 rgba(0,0,0,.06)}
    .list{flex:1;overflow:auto;padding:10px;overscroll-behavior:contain}

    /* ===== Cards ===== */
    .task{background:#ffffff;margin:8px 0;border:1px solid var(--border);border-left:10px solid var(--border);border-radius:10px;padding:12px;box-shadow:0 2px 6px rgba(2,6,23,.06);position:relative}
    .task.overdue{border-left-color:var(--late)}
    .task.block{border-left-color:var(--block)}
    .task.exec{border-left-color:var(--exec)}
    .task.done{border-left-color:var(--ok)}
    .title{font-weight:800;margin-bottom:6px}
    .meta-text{font-size:13px;color:var(--muted)}
    .chip{display:inline-block;background:var(--chip);padding:2px 8px;border-radius:999px;font-size:12px;font-weight:700;margin-left:6px}
    .code{display:inline-block;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:12px;background:#eef2ff;color:#0f172a;border:1px solid #c7d2fe;padding:2px 6px;border-radius:6px;margin-right:6px}
    .delta{font-weight:700}

    /* ===== Progresso ===== */
    .progress{margin-top:8px;background:#e5e7eb;border:1px solid #d1d5db;border-radius:999px;height:10px;overflow:hidden}
    .progress-inner{height:100%;width:0%;background:linear-gradient(90deg, #60a5fa, #22c55e);transition:width .3s ease}
    .progress-label{margin-top:4px;font-size:12px;color:#334155;display:flex;justify-content:space-between}

    /* ===== Suprimentos ===== */
    .section{margin-top:6px;padding-top:6px;border-top:1px dashed var(--border)}
    .section h3{position:sticky;top:0;z-index:6;margin:0 0 6px;background:var(--header);padding:8px;border:1px solid var(--border);border-radius:8px;text-align:center;font-size:14px}
    .item{background:#ffffff;border:1px solid var(--border);border-left:8px solid var(--border);border-radius:10px;padding:10px;margin:8px 0;box-shadow:0 2px 6px rgba(2,6,23,.06);position:relative}
    .item.overdue{border-left-color:var(--late)}
    .item.soon{border-left-color:var(--warn)}
    .item.ok{border-left-color:var(--ok)}
    .item.recv{border-left-color:var(--recv)}
    .row{display:flex;justify-content:space-between;gap:8px;font-size:14px}
    .kv{font-size:12px;color:var(--muted)}

    footer{
      padding:10px 16px;border-top:1px solid var(--border);background:#fff;color:#334155;
      font-size:12px; display:flex; justify-content:center; align-items:center; min-height:40px;
    }
  </style>
</head>
<body>
  <header id="hdr">
    <div class="brand">
      <div class="logo-box"><img id="logo" class="logo-img" alt="Logo System Engenharia" /><div id="logoPh" class="logo-ph">LOGO</div></div>
      <div>
        <h1>Atl√¢ntico Golf ‚Äî Quadro Kanban</h1>
        <div class="subtitle" id="subtitle">Vis√£o consolidada de campo e suprimentos. Hist√≥rico sempre preservado.</div>
      </div>
    </div>
    <div class="meta">
      <div class="stamp" id="stamp">Quadro atualizado pela engenharia em --/--/---- --:--</div>
      <div class="clock" id="clock">--:--:--</div>
    </div>
  </header>

  <div class="board" id="board"></div>

  <footer id="ftr"></footer>

  <script>
  (function(){
    'use strict';

    /* =================== DADOS =================== */
    var DATA = {
      logo_src: 'assets/logo.jpg',
      encarregados:[
        {nome:'Severo (Hidr√°ulica)', tarefas:[
          {codigo:'T-0313', titulo:'Rede hidr√°ulica de entrada de √°gua ‚Äî conclus√£o', prazo_esperado:'19/09/2025', status:'exec', pct:85, obs:'Madeiras e paletes no caminho obstru√≠do (almoxarifado da Asas).'},
          {codigo:'T-0314', titulo:'Troca do suporte da rede √ò110 mm: perfilado ‚Üí cantoneira (recalque de pluviais e esgoto)', prazo_esperado:'19/09/2025', status:'exec', pct:90, obs:'Madeiras e paletes no caminho obstru√≠do (almoxarifado da Asas).'},
          {codigo:'T-0322', titulo:'Retrabalho de 7 caixas de rede externa, reposicionamento de tubula√ß√µes e acabamento ‚Äî aditivo', prazo_esperado:'26/09/2025', status:'exec', pct:20, obs:'Pendente: 6 pe√ßas de tubo √ò200 solicitadas por transfer√™ncia.'},
          {codigo:'T-0323', titulo:'Montagem de conjuntos de bombas em 3 po√ßos', prazo_esperado:'26/09/2025', status:'', pct:0, obs:'Falta de material: joelho 90¬∞ √ó 60 sold√°vel. In√≠cio previsto com desvio de rede no subsolo do Bloco 3 (obstru√ß√£o da porta).'},

          // === NOVAS TAREFAS (janela 29/09 a 03/10) ===
          {codigo:'T-0329', titulo:'Rede de po√ßos ‚Äî tubo √ò110 mm (po√ßos)', prazo_esperado:'03/10/2025', status:'', pct:0, obs:'Janela: 29/09 a 03/10.'},
          {codigo:'T-0330', titulo:'√Åguas pluviais ‚Äî po√ßos 07, 08 e 11', prazo_esperado:'03/10/2025', status:'', pct:0, obs:'Janela: 29/09 a 03/10.'},
          {codigo:'T-0331', titulo:'√Åguas servidas ‚Äî po√ßos 07 e 18', prazo_esperado:'03/10/2025', status:'', pct:0, obs:'Janela: 29/09 a 03/10.'}
        ]},
        {nome:'Airton (Hidr√°ulica)', tarefas:[
          {codigo:'T-0305', titulo:'Entrega de apartamentos para a Qualidade ‚Äî Blocos 2 e 3 ‚Äî 1¬∫ ao 4¬∫ pavimentos', prazo_esperado:'19/09/2025', status:'done', pct:100, data_conclusao:'19/09/2025'},
          {codigo:'T-0306', titulo:'Instala√ß√£o da redutora de press√£o ‚Äî 8¬∫ pavimento ‚Äî Bloco 3', prazo_esperado:'19/09/2025', status:'exec', pct:100},
          {codigo:'T-0324', titulo:'Entrega de apartamentos ‚Äî 4¬∫ ao 6¬∫ pavimentos dos Blocos 2 e 3', prazo_esperado:'26/09/2025', status:'', pct:0, obs:'Segue sem avan√ßo.'},
          {codigo:'T-0325', titulo:'Execu√ß√£o da redutora de press√£o ‚Äî 12¬∫ pavimento do Bloco 3', prazo_esperado:'26/09/2025', status:'', pct:10}
        ]},
        {nome:'Thiago (El√©trica)', tarefas:[
          {codigo:'T-0315', titulo:'Tratamento de todas as eletrocalhas', prazo_esperado:'19/09/2025', status:'done', pct:100, data_conclusao:'19/09/2025'},
          {codigo:'T-0317', titulo:'Instala√ß√£o de 5 quadros de bombas', prazo_esperado:'19/09/2025', status:'done', pct:100, data_conclusao:'18/09/2025'},
          {codigo:'T-0316', titulo:'Instala√ß√£o de lumin√°rias ‚Äî trecho central do subsolo (¬±50 unidades em zonas apagadas)', prazo_esperado:'19/09/2025', status:'exec', pct:100},
          {codigo:'T-0321', titulo:"Instala√ß√£o de CSMD's dos blocos 1, 2 e 3", prazo_esperado:'26/09/2025', status:'exec', pct:30, obs:'Frentes: (1) Infra no subsolo para autom√°tico de boia das torres ‚Äî 22/09 a 26/09; (2) Montagem de eletrocalha 200√ó150 para comandos no trecho central do subsolo ‚Äî 22/09 a 26/09; (3) Montagem de perfilado 38√ó38 para ilumina√ß√£o do espelho d‚Äô√°gua 2 ‚Äî 22/09 a 26/09.'},

          // === NOVA TAREFA (janela 29/09 a 03/10) ===
          {codigo:'T-0337', titulo:'Instala√ß√£o de 100 lumin√°rias ‚Äî trecho entre a casa de bombas e o espelho d‚Äô√°gua', prazo_esperado:'03/10/2025', status:'', pct:0, obs:'Janela: 29/09 a 03/10.'}
        ]},
        {nome:'Marcelo (El√©trica)', tarefas:[
          {codigo:'T-0318', titulo:'Entrega de apartamentos', prazo_esperado:'19/09/2025', status:'exec', pct:80},
          {codigo:'T-0319', titulo:'Fechamento de QDLs dos apartamentos ‚Äî 19¬∫ e 20¬∫ (duas torres)', prazo_esperado:'19/09/2025', status:'block', pct:40, obs:"Aguardando materiais (componentes para QDL's)"},
          {codigo:'T-0320', titulo:'SPDA das duas torres (executar √°reas liberadas)', prazo_esperado:'19/09/2025', status:'exec', pct:30},
          {codigo:'T-0326', titulo:'Instala√ß√£o das tampas dos barramentos blindados verticais ‚Äî 3 torres', prazo_esperado:'26/09/2025', status:'', pct:50},
          {codigo:'T-0327', titulo:'Ensaios/funcionais dos barramentos blindados', prazo_esperado:'26/09/2025', status:'', pct:33},
          {codigo:'T-0328', titulo:'Instala√ß√£o dos cofres pendentes', prazo_esperado:'26/09/2025', status:'', pct:33},

          // === NOVAS TAREFAS (janela 29/09 a 03/10) ===
          {codigo:'T-0332', titulo:'Lan√ßamento de cabos ‚Äî Bomba de recalque Bloco 1', prazo_esperado:'03/10/2025', status:'', pct:0, obs:'Janela: 29/09 a 03/10.'},
          {codigo:'T-0333', titulo:'Lan√ßamento de cabos ‚Äî Bomba de recalque Bloco 2', prazo_esperado:'03/10/2025', status:'', pct:0, obs:'Janela: 29/09 a 03/10.'},
          {codigo:'T-0334', titulo:'Lan√ßamento de cabos ‚Äî Bomba de recalque Bloco 3', prazo_esperado:'03/10/2025', status:'', pct:0, obs:'Janela: 29/09 a 03/10.'},
          {codigo:'T-0335', titulo:'Passagem de fia√ß√£o para os espelhos d‚Äô√°gua 2 e 3', prazo_esperado:'03/10/2025', status:'', pct:0, obs:'Janela: 29/09 a 03/10.'},
          {codigo:'T-0336', titulo:'Passagem/lan√ßamento de cabos ‚Äî po√ßos de √°guas servidas 03A e 03B', prazo_esperado:'03/10/2025', status:'', pct:0, obs:'Janela: 29/09 a 03/10.'}
        ]}
      ],
      /* =================== SUPRIMENTOS ‚Äî APENAS NOVAS INFORMA√á√ïES =================== */
      suprimentos:{
        compradores:['Br√≠gida Souza','Suellen Mello','Lucas Fernandes'],
        pendencias_teams:{'Br√≠gida Souza':0,'Suellen Mello':0,'Lucas Fernandes':0},
        requisicoes:[
          {codigo:'RQ-11305', numero:'RQ-11305', responsavel:'Br√≠gida Souza', contrato:'Atl√¢ntico', material:'Condulete', aplicacao:'-', data:'', prazo:'', status:'Em cota√ß√£o', obs:'Requisi√ß√£o atribu√≠da para cota√ß√£o'},

          {codigo:'RQ-11086', numero:'RQ-11086', responsavel:'Suellen Mello', contrato:'Atl√¢ntico', material:'Repastilhamento', aplicacao:'-', data:'', prazo:'', status:'', obs:'Fornecedor: TRIUNFO (LOC). Aguardando retorno da obra sobre disponibilidade de brocas para retirada'},
          {codigo:'RQ-11295', numero:'RQ-11295', responsavel:'Suellen Mello', contrato:'Atl√¢ntico', material:'Material de fixa√ß√£o', aplicacao:'-', data:'', prazo:'', status:'', obs:'OC 587 ‚Äî 16/09 parcial'},
          {codigo:'RQ-11309', numero:'RQ-11309', responsavel:'Suellen Mello', contrato:'Atl√¢ntico', material:'Parafuso', aplicacao:'-', data:'', prazo:'', status:'', obs:'Fornecedor: PARAFUSOPAR. OC: system. N√£o chegou'},
          {codigo:'RQ-11181', numero:'RQ-11181', responsavel:'Suellen Mello', contrato:'Atl√¢ntico', material:'PVC', aplicacao:'Ralos embasamento / fechamento de bombas', data:'', prazo:'', status:'', obs:'OC 597 ‚Äî 18/09 parcial'},

          {codigo:'RQ-10623', numero:'RQ-10623', responsavel:'Lucas Fernandes', contrato:'Atl√¢ntico', material:'Quadros de entrada de energia', aplicacao:'Entrada de energia', data:'', prazo:'', status:'', obs:'OC 009 ‚Äî 09/09 parcial; restante 25/09'},
          {codigo:'RQ-11282', numero:'RQ-11282', responsavel:'Lucas Fernandes', contrato:'Atl√¢ntico', material:'T√™ de fachada', aplicacao:'Fachada', data:'', prazo:'', status:'', obs:'OC 591 ‚Äî n√£o chegou'},
          {codigo:'RQ-11237', numero:'RQ-11237', responsavel:'Lucas Fernandes', contrato:'Atl√¢ntico', material:'Fitas isolantes', aplicacao:'El√©trica for√ßa e distribui√ß√£o', data:'', prazo:'', status:'', obs:'OC 585 ‚Äî chegou 16/09'},
          {codigo:'RQ-11238', numero:'RQ-11238', responsavel:'Lucas Fernandes', contrato:'Atl√¢ntico', material:'Ralo + PVC', aplicacao:'Distribui√ß√£o hidr√°ulica t√©rreo', data:'', prazo:'', status:'', obs:'OC 595 ‚Äî entrega parcial 19/09'},
          {codigo:'RQ-11333', numero:'RQ-11333', responsavel:'Lucas Fernandes', contrato:'Atl√¢ntico', material:'T√™ de fachada', aplicacao:'Fachada', data:'', prazo:'', status:'', obs:'OC 593 ‚Äî Chegou'},
          {codigo:'RQ-11314', numero:'RQ-11314', responsavel:'Lucas Fernandes', contrato:'Atl√¢ntico', material:'Fitas isolantes', aplicacao:'El√©trica for√ßa e distribui√ß√£o', data:'', prazo:'', status:'', obs:'OC 590 ‚Äî 17/09/2025'},
          {codigo:'RQ-11291', numero:'RQ-11291', responsavel:'Lucas Fernandes', contrato:'Atl√¢ntico', material:'PIAL PLUS+', aplicacao:'√Åreas comuns / subsolo / escadas / coberturas / extravios', data:'', prazo:'', status:'Em cota√ß√£o', obs:'Requisi√ß√£o atribu√≠da para cota√ß√£o'},
          {codigo:'RQ-11294', numero:'RQ-11294', responsavel:'Lucas Fernandes', contrato:'Atl√¢ntico', material:'Arandelas', aplicacao:'Escadas e √°reas t√©cnicas', data:'', prazo:'', status:'Em cota√ß√£o', obs:'Requisi√ß√£o atribu√≠da para cota√ß√£o'}
        ],
        ocs:[
          {codigo:'OC-587', numero:'OC-587', emissao:'', fornecedor:'WALSYWA Com√©rcio de Produtos Metal√∫rgicos Ltda', status:'EMITIDA', previsao:'', comprador:'Suellen', recebido:'16/09/2025', origem_rq:'RQ-11295', material:'Material de fixa√ß√£o', aplicacao:'-', obs_comprador:'Parcial'},
          {codigo:'OC-597', numero:'OC-597', emissao:'', fornecedor:'KG Instala√ß√µes e Com. El√©trico', status:'EMITIDA', previsao:'', comprador:'Suellen', recebido:'18/09/2025', origem_rq:'RQ-11181', material:'PVC', aplicacao:'Ralos/fechamentos', obs_comprador:'Parcial'},
          {codigo:'OC-009', numero:'OC-009', emissao:'', fornecedor:'ELETROASA ‚Äî Eletrometal√∫rgica ASA Eireli', status:'EMITIDA', previsao:'25/09/2025', comprador:'Lucas', recebido:'09/09/2025', origem_rq:'RQ-10623', material:'Quadros de entrada de energia', aplicacao:'Entrada de energia', obs_comprador:'Entrega parcial 09/09; restante 25/09'},
          {codigo:'OC-591', numero:'OC-591', emissao:'', fornecedor:'Westaflex Tubos Flex√≠veis Ltda', status:'EMITIDA', previsao:'', comprador:'Lucas', recebido:'', origem_rq:'RQ-11282', material:'T√™ de fachada', aplicacao:'Fachada', obs_comprador:'N√£o chegou'},
          {codigo:'OC-585', numero:'OC-585', emissao:'', fornecedor:'Lukma', status:'EMITIDA', previsao:'', comprador:'Lucas', recebido:'16/09/2025', origem_rq:'RQ-11237', material:'Fita isolante', aplicacao:'El√©trica for√ßa e distribui√ß√£o'},
          {codigo:'OC-595', numero:'OC-595', emissao:'', fornecedor:'KG Instala√ß√µes e Com√©rcio El√©trico Ltda', status:'EMITIDA', previsao:'', comprador:'Lucas', recebido:'19/09/2025', origem_rq:'RQ-11238', material:'Ralo + PVC', aplicacao:'Distribui√ß√£o hidr√°ulica t√©rreo', obs_comprador:'Entrega parcial'},
          {codigo:'OC-593', numero:'OC-593', emissao:'', fornecedor:'Mosal Artefatos de Alum√≠nio Ltda - ME', status:'recebido', previsao:'', comprador:'Lucas', recebido:'', origem_rq:'RQ-11333', material:'T√™ de fachada', aplicacao:'Fachada', obs_comprador:'Chegou'},
          {codigo:'OC-590', numero:'OC-590', emissao:'', fornecedor:'Lukma', status:'EMITIDA', previsao:'17/09/2025', comprador:'Lucas', recebido:'', origem_rq:'RQ-11314', material:'Fitas isolantes', aplicacao:'El√©trica for√ßa e distribui√ß√£o'}
        ]
      }
    };

    /* ==== Datas, ordena√ß√£o e helpers ==== */
    var DAY=86400000, HOUR=36e5;
    function parseBRDate(s){ if(!s) return null; var a=s.split('/'); if(a.length!==3) return null; var d=+a[0],m=+a[1],y=+a[2]; var dt=new Date(y,m-1,d,12,0,0); return isNaN(dt)?null:dt }
    function diffDays(a,b){ return Math.round((a-b)/DAY) }
    function fmtClock(){ var t=new Date(); var pad=n=>String(n).padStart(2,'0'); return pad(t.getHours())+':'+pad(t.getMinutes())+':'+pad(t.getSeconds()) }

    // Helpers gen√©ricos p/ pegar datas em tarefas e suprimentos
    function getDueDate(t){ return parseBRDate(t.prazo_esperado||t.prazo||t.previsao||t.data||''); }
    function getDoneDate(t){ return parseBRDate(t.data_conclusao||t.finalizado_em||''); }

    function dLabel(dateStr){ var d=parseBRDate(dateStr); if(!d) return ''; var delta=Math.floor((d-new Date())/DAY); if(delta===0) return 'D-0'; return (delta>0)?('D-'+delta):('D+'+Math.abs(delta)) }
    function isPastDue(dateStr){ var d=parseBRDate(dateStr); if(!d) return false; return (new Date() - d) > 0; }
    function urgencyByDate(dateStr,status){
      // 1) Se estiver conclu√≠da, mant√©m verde; caso contr√°rio, prazo estourado prevalece e fica vermelho
      if(status==='done'||status==='FINALIZADA') return 'done';
      if(isPastDue(dateStr)) return 'overdue';
      // 2) Demais estados visuais
      if(status==='recebido') return 'recv';
      if(status==='block') return 'block';
      if(status==='exec') return 'exec';
      // 3) Sem status expl√≠cito, usa aproxima√ß√£o por proximidade de prazo
      var d=parseBRDate(dateStr); if(!d) return 'ok';
      var h=(d-new Date())/HOUR; if(h<=48) return 'soon';
      return 'ok'; }

    // ==== NOVO: ordenar conclu√≠das sempre no fim por data de conclus√£o (asc) ====
    function effectiveDone(t){ return (t.status==='done'||t.status==='FINALIZADA'|| Number(t.pct||0) >= 100); }
    function doneSortDate(t){ return getDoneDate(t) || new Date(0); }

    function weightUrgencyByDate(ds){ var d=parseBRDate(ds); if(!d) return 3; var h=(d-new Date())/HOUR; if(h<=0) return 0; if(h<=48) return 1; return 2 }

    function compareByPrazo(a,b){
      var aDone = effectiveDone(a), bDone = effectiveDone(b);
      if(aDone !== bDone){ return aDone ? 1 : -1; } // n√£o conclu√≠das primeiro; conclu√≠das sempre no fim

      // Se ambos conclu√≠dos, ordenar pela data de conclus√£o (mais antiga primeiro)
      if(aDone && bDone){
        var da = doneSortDate(a), db = doneSortDate(b);
        if(da && db) return da - db;
        if(da && !db) return -1;
        if(!da && db) return 1;
        return 0;
      }

      // Para n√£o conclu√≠das, ordenar por urg√™ncia / proximidade do prazo
      var ua=weightUrgencyByDate(a.prazo_esperado||a.prazo||a.previsao||a.data||''), ub=weightUrgencyByDate(b.prazo_esperado||b.prazo||b.previsao||b.data||'');
      if(ua!==ub) return ua-ub;
      var da2=getDueDate(a), db2=getDueDate(b);
      if(da2&&db2) return da2-db2; if(da2&&!db2) return -1; if(!da2&&db2) return 1; return 0;
    }

    function compareOC(a,b){ var ar=!!a.recebido, br=!!b.recebido;
      if(ar!==br) return br-ar;
      if(ar&&br){ var da=parseBRDate(a.recebido), db=parseBRDate(b.recebido);
        if(da&&db) return db-da; if(da&&!db) return -1; if(!da&&db) return 1; return 0 }
      // mant√©m a mesma l√≥gica de urg√™ncia para OCs
      var pa = {status:a.status,prazo:a.previsao}, pb = {status:b.status,prazo:b.previsao};
      return compareByPrazo(pa,pb) }

    function deltaConclusaoDias(t){
      var due=getDueDate(t), done=getDoneDate(t);
      if(!due || !done) return null;
      return Math.round((done - due)/86400000); // + = atraso, - = adiantado
    }

    /* =================== DOM =================== */
    function el(tag,cls,text){ var e=document.createElement(tag); if(cls)e.className=cls; if(text!=null)e.textContent=text; return e }
    var boardEl=document.getElementById('board');

    function render(){
      boardEl.innerHTML='';

      // === Colunas por Encarregado ===
      for(var i=0;i<DATA.encarregados.length;i++){
        var enc=DATA.encarregados[i];
        var tasks=(enc.tarefas||[]).slice().sort(compareByPrazo);
        var col=el('section','column');
        col.appendChild(el('h2','',enc.nome));
        var list=el('div','list');

        for(var j=0;j<tasks.length;j++){
          var t=tasks[j];

          // Auto-finaliza√ß√£o visual quando pct >= 100
          var pctVal = Math.max(0, Math.min(100, Number(t.pct||0)));
          if(pctVal >= 100 && !(t.status==='done'||t.status==='FINALIZADA')){
            t.status = 'done';
          }

          var dueStr=t.prazo_esperado||t.prazo||'';
          var cls=urgencyByDate(dueStr,t.status);
          var card=el('div','task '+cls);

          var code=el('span','code','#'+(t.codigo||''));
          var title=el('span','title'); title.textContent=t.titulo;
          var header=el('div'); header.appendChild(code); header.appendChild(title);

          var meta=el('div','meta-text');
          var partes=[];
          var label1='Prazo esperado: '+(dueStr||'-');
          if(!(t.status==='done'||t.status==='FINALIZADA')) label1 += ' ‚Ä¢ '+dLabel(dueStr||'');
          partes.push(label1);

          if(t.data_conclusao||t.finalizado_em){
            partes.push('Data de conclus√£o: '+(t.data_conclusao||t.finalizado_em));
          }
          var dlt=deltaConclusaoDias(t);
          if(dlt!==null){
            var sinal = dlt>0?'+': (dlt<0?'-':'¬±');
            var legenda = dlt>0? ' (atraso)': (dlt<0? ' (adiantado)':' (no prazo)');
            partes.push('Diferen√ßa: '+sinal+Math.abs(dlt)+'d'+legenda);
          }
          if(t.obs){ partes.push('Obs.: '+t.obs); }

          meta.innerHTML = partes.map(function(p){return '<div>'+p+'</div>';}).join('');

          var statusLabel='Pendente';
          if(t.status==='exec')statusLabel='Em execu√ß√£o';
          else if(t.status==='block')statusLabel='Bloqueada';
          else if(t.status==='done'||t.status==='FINALIZADA')statusLabel='Finalizada üèÜ';
          else if(cls==='overdue')statusLabel='Atrasada';
          var chip=el('span','chip',statusLabel);
          meta.appendChild(chip);

          var pWrap=el('div','progress'); var pBar=el('div','progress-inner'); pBar.style.width=pctVal+'%'; pWrap.appendChild(pBar);
          var pLabel=el('div','progress-label'); pLabel.appendChild(el('span','', 'Avan√ßo: '+pctVal+'%'));
          pLabel.appendChild(el('span','', (cls==='overdue'?'‚ö†Ô∏è aten√ß√£o ao prazo':'')));

          card.appendChild(header);
          card.appendChild(meta);
          card.appendChild(pWrap); card.appendChild(pLabel);
          list.appendChild(card);
        }

        col.appendChild(list); boardEl.appendChild(col);
      }

      // === Coluna Suprimentos ===
      var sup=el('section','column'); sup.appendChild(el('h2','','Suprimentos')); var sList=el('div','list');

      // Requisi√ß√µes
      var rqSec=el('div','section'); rqSec.appendChild(el('h3','', 'Requisi√ß√µes em Aberto'));
      var rqs=(DATA.suprimentos.requisicoes||[]).slice().sort(function(a,b){
        // usa mesma heur√≠stica para proximidade de prazo
        var pa={status:a.status,prazo:a.prazo,finalizado_em:a.finalizado_em}, pb={status:b.status,prazo:b.prazo,finalizado_em:b.finalizado_em};
        return compareByPrazo(pa,pb);
      });
      for(var r=0;r<rqs.length;r++){
        var rq=rqs[r]; var dtPrazo=parseBRDate(rq.prazo); var dtData=parseBRDate(rq.data);
        var lt=(dtPrazo&&dtData)?(Math.round((dtPrazo-dtData)/86400000)+'d'):'-';
        var clsRq=urgencyByDate(rq.prazo,rq.status);
        var it=el('div','item '+clsRq);

        var rowTop=el('div','row');
        var left=el('div'); left.appendChild(el('span','code','#'+(rq.codigo||rq.numero||''))); left.appendChild(el('strong','',rq.numero||rq.codigo||'RQ'));
        rowTop.appendChild(left); rowTop.appendChild(el('span','',rq.status||''));

        var kv1=el('div','kv','Data: '+(rq.data||'-')+' ‚Ä¢ Prazo: '+(rq.prazo||'-')+' ‚Ä¢ Lead time esperado: '+lt);
        var kv2=el('div','kv','Respons√°vel: '+(rq.responsavel||'-')+' ‚Ä¢ Contrato: '+(rq.contrato||'-')+' ‚Ä¢ Material: '+(rq.material||'-'));
        var kv3=el('div','kv','Aplica√ß√£o: '+(rq.aplicacao||'-')+' ‚Ä¢ Obs.: '+(rq.obs||'-'));
        it.appendChild(rowTop); it.appendChild(kv1); it.appendChild(kv2); it.appendChild(kv3);
        if(rq.obs_comprador){ it.appendChild(el('div','kv','Obs. comprador: '+rq.obs_comprador)); }
        rqSec.appendChild(it);
      }
      sList.appendChild(rqSec);

      // OCs
      var ocSec=el('div','section'); ocSec.appendChild(el('h3','', 'Ordens de Compra (OC)'));
      var ocs=(DATA.suprimentos.ocs||[]).slice().sort(compareOC);
      for(var o=0;o<ocs.length;o++){
        var oc=ocs[o];
        var dtRec=parseBRDate(oc.recebido); var dtEmi=parseBRDate(oc.emissao);
        var ltReal=(dtRec&&dtEmi)?(Math.round((dtRec-dtEmi)/86400000)+'d'):'-';
        var clsOc=oc.recebido?'recv':urgencyByDate(oc.previsao,oc.status);
        var it2=el('div','item '+clsOc);

        var rowTop2=el('div','row'); var left2=el('div');
        left2.appendChild(el('span','code','#'+(oc.codigo||oc.numero||''))); left2.appendChild(el('strong','',oc.numero||oc.codigo||'OC'));
        rowTop2.appendChild(left2); rowTop2.appendChild(el('span','',oc.status||''));

        var kv3=el('div','kv','Fornecedor: '+(oc.fornecedor||'-')+' ‚Ä¢ Comprador: '+(oc.comprador||'-')+' ‚Ä¢ Origem: '+(oc.origem_rq||'-'));
        var kv4=el('div','kv','Material: '+(oc.material||'-')+' ‚Ä¢ Aplica√ß√£o: '+(oc.aplicacao||'-'));
        var kv5=el('div','kv','Emiss√£o: '+(oc.emissao||'-')+' ‚Ä¢ Previs√£o: '+(oc.previsao||'-')+' ‚Ä¢ Lead time real: '+ltReal);
        var st=el('div','kv', oc.recebido?('Recebido em '+oc.recebido):'Pendente');
        it2.appendChild(rowTop2); it2.appendChild(kv3); it2.appendChild(kv4); it2.appendChild(kv5); it2.appendChild(st);
        if(oc.obs_comprador){ it2.appendChild(el('div','kv','Obs. comprador: '+oc.obs_comprador)); }
        ocSec.appendChild(it2);
      }
      sList.appendChild(ocSec);
      sup.appendChild(sList); boardEl.appendChild(sup);
    }

    function initLogo(){ var img=document.getElementById('logo'); var ph=document.getElementById('logoPh'); var src=DATA.logo_src||''; if(!src){img.style.display='none'; ph.style.display='flex'; return;} img.onload=function(){img.style.display='block'; ph.style.display='none';}; img.onerror=function(){img.style.display='none'; ph.style.display='flex';}; img.src=src; }

    function tick(){ document.getElementById('clock').textContent = fmtClock(); }
    function updateHeaderHeights(){ var h = document.getElementById('hdr').offsetHeight || 112; document.documentElement.style.setProperty('--header-h', h + 'px'); }
    function setStamp(){ var d = new Date(); var pad=n=>String(n).padStart(2,'0'); var stamp = 'Quadro atualizado pela engenharia em ' + pad(d.getDate())+'/'+pad(d.getMonth()+1)+'/'+d.getFullYear()+' '+pad(d.getHours())+':'+pad(d.getMinutes()); document.getElementById('stamp').textContent = stamp; }
    function setFooterNote(){ var d = new Date(); var pad=n=>String(n).padStart(2,'0'); document.getElementById('ftr').textContent = 'C√≥digo atualizado pela engenharia em '+pad(d.getDate())+'/'+pad(d.getMonth()+1)+'/'+d.getFullYear()+' √†s '+pad(d.getHours())+':'+pad(d.getMinutes()); }

    document.addEventListener('DOMContentLoaded', function(){
      initLogo();
      render();
      setStamp();
      setFooterNote();
      updateHeaderHeights();
      tick();
      setInterval(tick, 1000);
      window.addEventListener('resize', updateHeaderHeights);
    });
  })();
  </script>
</body>
</html>
