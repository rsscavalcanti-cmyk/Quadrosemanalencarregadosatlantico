<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Atl√¢ntico Golf ‚Äî Kanban (WhatsApp Share + Suprimentos)</title>
  <meta name="description" content="Kanban mobile. Bot√£o WhatsApp em cada card (nota obrigat√≥ria) e coluna de Suprimentos de volta. Com filtros de status por servi√ßo." />
  <meta name="theme-color" content="#0b2a4a" />
  <style>
    :root{ --bg:#f6f8fc; --text:#0f172a; --muted:#475569; --brand:#0e3a6d; --brand2:#0b2a4a;
      --card:#ffffff; --border:#d6e0ea; --head:#f1f5f9; --ring:#38bdf8;
      --ok:#16a34a; --warn:#ca8a04; --late:#b91c1c; --block:#9333ea; --exec:#0ea5e9; --recv:#15803d;
      --chip:#e2e8f0; --mono:#111827; --wa:#25D366; --wa-dark:#1EA955;
      --header-h:92px; --footer-h:84px; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;background:var(--bg);color:var(--text)}

    header{position:sticky;top:0;z-index:100;display:flex;flex-direction:column;gap:10px;padding:12px 16px;background:linear-gradient(90deg,var(--brand2),var(--brand));color:#fff;box-shadow:0 4px 18px rgba(2,6,23,.18)}
    .head-top{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:12px;min-width:240px}
    .logo{height:42px;width:auto;display:block;object-fit:contain}
    h1{margin:0;font-size:20px}
    .subtitle{margin-top:2px;font-size:12px;opacity:.9}
    .meta{display:flex;flex-direction:column;gap:4px;text-align:right}
    .stamp{font-size:12px;font-weight:700}
    .clock{font-variant-numeric:tabular-nums;font-size:12px;opacity:.95}

    /* Board */
    .board{height:calc(100vh - var(--header-h) - var(--footer-h));display:flex;gap:12px;padding:12px 12px 16px;overflow-x:auto;overflow-y:hidden;scroll-snap-type:x mandatory;-webkit-overflow-scrolling:touch;scroll-behavior:smooth}
    .column{background:var(--card);border:1px solid var(--border);border-radius:14px;min-width:300px;max-width:480px;flex:1;display:flex;flex-direction:column;height:100%;overflow:hidden;scroll-snap-align:start;contain:layout paint;}
    .column h2{position:sticky;top:0;z-index:10;margin:0;padding:10px 12px;background:var(--head);font-size:16px;font-weight:800;border-bottom:1px solid var(--border);text-align:center}
    .list{flex:1;overflow:auto;padding:10px}

    .task,.item{background:#fff;margin:8px 0;border:1px solid var(--border);border-left:10px solid var(--border);border-radius:12px;padding:12px 12px 10px;box-shadow:0 3px 10px rgba(2,6,23,.06);position:relative}
    .task.overdue,.item.overdue{border-left-color:var(--late)}
    .task.block,.item.block{border-left-color:var(--block)}
    .task.exec,.item.exec{border-left-color:var(--exec)}
    .task.done,.item.done{border-left-color:var(--ok)}
    .item.soon{border-left-color:var(--warn)}
    .item.ok{border-left-color:var(--ok)}
    .item.recv{border-left-color:var(--recv)}

    .title{font-weight:800;margin-bottom:6px;line-height:1.25}
    .meta-text{font-size:13px;color:var(--muted);display:grid;gap:2px}
    .chip{display:inline-block;background:var(--chip);padding:2px 8px;border-radius:999px;font-size:12px;font-weight:700;margin-left:6px}
    .code{display:inline-block;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:12px;background:#eef2ff;color:var(--mono);border:1px solid #c7d2fe;padding:2px 6px;border-radius:6px;margin-right:6px}

    .progress{margin-top:8px;background:#e5e7eb;border:1px solid #d1d5db;border-radius:999px;height:10px;overflow:hidden}
    .progress-inner{height:100%;width:0%;background:linear-gradient(90deg,#60a5fa,#22c55e);transition:width .35s ease}
    .progress-label{margin-top:4px;font-size:12px;color:#334155;display:flex;justify-content:space-between}

    .row{display:flex;justify-content:space-between;gap:8px;font-size:14px}
    .kv{font-size:12px;color:var(--muted)}

    /* Rodap√© com filtros discretos */
    footer{position:sticky;bottom:0;background:#fff;border-top:1px solid var(--border);color:#334155;font-size:12px}
    .foot-wrap{max-width:1100px;margin:0 auto;padding:6px 10px}
    .filters{display:flex;gap:6px;overflow:auto;padding:6px 0}
    .filters::-webkit-scrollbar{height:6px}
    .filters::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:6px}
    .fbtn{
      appearance:none;border:1px dashed #cbd5e1;background:#f8fafc;color:#334155;
      padding:6px 10px;border-radius:999px;font-size:11px;font-weight:700;opacity:.9;cursor:pointer;white-space:nowrap
    }
    .fbtn[aria-pressed="true"]{background:#eef2ff;border-style:solid;border-color:#93c5fd}
    .fkey{font-size:10px;opacity:.85;border:1px solid currentColor;border-radius:6px;padding:0 6px;margin-right:4px}
    .fcnt{font-variant-numeric:tabular-nums;background:#e2e8f0;padding:2px 6px;border-radius:8px;margin-left:6px}

    .share-btn{position:absolute;top:8px;right:8px;width:28px;height:28px;border:none;border-radius:999px;background:var(--wa);color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;opacity:.92;box-shadow:0 2px 6px rgba(2,6,23,.15)}
    .share-btn:hover{opacity:1}
    .share-btn:active{transform:scale(.96)}
    .share-btn:focus-visible{outline:2px solid var(--ring);outline-offset:2px}
    .wa-ico{width:16px;height:16px;display:block}

    .modal{position:fixed;inset:0;background:rgba(2,6,23,.5);display:none;align-items:center;justify-content:center;padding:16px;z-index:200}
    .modal.open{display:flex}
    .modal-card{width:100%;max-width:520px;background:var(--card);border:1px solid var(--border);border-radius:14px;box-shadow:0 12px 30px rgba(2,6,23,.25);padding:14px}
    .modal-title{margin:0 0 8px;font-size:16px;font-weight:800}
    .modal-sub{margin:0 0 8px;font-size:12px;color:var(--muted)}
    .modal-textarea{width:100%;min-height:96px;border:1px solid var(--border);border-radius:10px;padding:10px;font-size:14px;resize:vertical}
    .modal-actions{margin-top:12px;display:flex;gap:8px;justify-content:flex-end}
    .btn{appearance:none;border:none;padding:10px 12px;border-radius:10px;font-weight:700;cursor:pointer}
    .btn.cancel{background:#e5e7eb}
    .btn.send{background:var(--wa);color:#fff;display:inline-flex;align-items:center;gap:8px}
    .btn.send .wa-ico{filter:brightness(0) invert(1)}

    .hidden{display:none !important}

    @media (prefers-color-scheme:dark){
      :root{--bg:#0b1220;--text:#e5e7eb;--muted:#94a3b8;--card:#0f172a;--border:#1f2937}
      .btn.cancel{background:#1f2937;color:#e5e7eb}
      .share-btn{background:var(--wa-dark)}
      .fbtn{border-color:#334155;background:#0f172a;color:#e5e7eb}
      .fcnt{background:#1f2937}
      .fbtn[aria-pressed="true"]{background:#0b1220;border-color:#2563eb}
    }
  </style>
</head>
<body>
  <header id="hdr" role="banner" aria-label="Cabe√ßalho do Kanban">
    <div class="head-top">
      <div class="brand">
        <img class="logo" src="assets/logo.jpg" alt="System Engenharia" />
        <div>
          <h1>Atl√¢ntico Golf ‚Äî Quadro Kanban</h1>
          <div class="subtitle">Compartilhar o card no WhatsApp.</div>
        </div>
      </div>
      <div class="meta" aria-live="polite">
        <div class="stamp" id="stamp">--/--/---- --:--</div>
        <div class="clock" id="clock" aria-label="Rel√≥gio">--:--:--</div>
      </div>
    </div>
  </header>

  <main class="board" id="board" role="list" aria-label="Colunas do Kanban"></main>

  <footer id="ftr">
    <div class="foot-wrap">
      <!-- Filtros de status (no rodap√©, sutis) -->
      <nav class="filters" role="toolbar" aria-label="Filtros de status">
        <button type="button" class="fbtn" data-val="all" aria-pressed="true"><span class="fkey">Todos</span><span class="fcnt" data-cnt="all">0</span></button>
        <button type="button" class="fbtn" data-val="exec" aria-pressed="false">Em execu√ß√£o <span class="fcnt" data-cnt="exec">0</span></button>
        <button type="button" class="fbtn" data-val="block" aria-pressed="false">Bloqueadas <span class="fcnt" data-cnt="block">0</span></button>
        <button type="button" class="fbtn" data-val="overdue" aria-pressed="false">Atrasadas <span class="fcnt" data-cnt="overdue">0</span></button>
        <button type="button" class="fbtn" data-val="pending" aria-pressed="false">Pendentes <span class="fcnt" data-cnt="pending">0</span></button>
        <button type="button" class="fbtn" data-val="done" aria-pressed="false">Finalizadas <span class="fcnt" data-cnt="done">0</span></button>
        <button type="button" class="fbtn" data-val="clear" aria-pressed="false">Limpar</button>
      </nav>
    </div>
  </footer>

  <!-- Modal de nota antes de compartilhar -->
  <div class="modal" id="shareModal" role="dialog" aria-modal="true" aria-labelledby="shareTitle">
    <div class="modal-card">
      <h3 class="modal-title" id="shareTitle">Enviar no WhatsApp</h3>
      <p class="modal-sub">Escreva o coment√°rio que vai junto. O texto do card √© preenchido automaticamente com data e hora.</p>
      <textarea id="shareNote" class="modal-textarea" placeholder="Ex.: Aguardando libera√ß√£o do acesso no subsolo."></textarea>
      <div class="modal-actions">
        <button class="btn cancel" id="shareCancel">Cancelar</button>
        <button class="btn send" id="shareSend">
          <svg class="wa-ico" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M16 3C9.373 3 4 8.373 4 15c0 2.11.548 4.09 1.504 5.82L4 29l8.332-1.46C14.016 28.48 15.975 29 18 29c6.627 0 12-5.373 12-12S22.627 3 16 3zm0 2c5.523 0 10 4.477 10 10s-4.477 10-10 10c-1.822 0-3.53-.5-4.99-1.365l-.356-.213-4.7.824.85-4.572-.232-.375C5.557 18.188 5 16.65 5 15 5 9.477 10.477 5 16 5zm-4.04 4.75c-.202 0-.52.074-.792.37-.272.296-1.04 1.015-1.04 2.469s1.06 2.864 1.22 3.079c.162.215 2.09 3.183 5.073 4.454.715.305 1.273.484 1.71.617.72.22 1.372.186 1.89.11.58-.083 1.78-.73 2.04-1.43.26-.7.26-1.316.19-1.437-.07-.12-.277-.196-.575-.337-.298-.14-1.75-.87-2.02-.97-.27-.1-.47-.144-.668.14-.198.283-.786.942-.958 1.128-.17.186-.334.202-.624.067-.29-.135-1.24-.46-2.37-1.485-.88-.798-1.49-1.783-1.66-2.082-.17-.3-.02-.466.124-.61.122-.12.3-.33.447-.5.147-.17.2-.294.308-.49.108-.196.053-.368-.022-.512-.075-.143-.683-1.64-.94-2.236-.256-.595-.503-.52-.682-.52z" fill="#fff"/></svg>
          Enviar no WhatsApp
        </button>
      </div>
    </div>
  </div>

  <script>
  (()=>{
    'use strict';

    /* ===== DADOS ===== */
    const DATA = { /* ...dados exatamente como no seu snippet... */ };

    /* ===== Utils ===== */
    const DAY=86400000, HOUR=36e5;
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const el = (tag, cls, text) => { const e=document.createElement(tag); if(cls) e.className=cls; if(text!=null) e.textContent=text; return e };
    const pad = n => String(n).padStart(2,'0');
    const parseBRDate = s => { if(!s) return null; const a=s.split('/'); if(a.length!==3) return null; const [d,m,y]=a.map(Number); const dt=new Date(y,(m||1)-1,d||1,12,0,0); return isNaN(dt)?null:dt };
    const dLabel = s => { const d=parseBRDate(s); if(!d) return ''; const delta=Math.floor((d - new Date())/DAY); return delta===0? 'D-0' : (delta>0? 'D-'+delta : 'D+'+Math.abs(delta)); };
    const isPastDue = s => { const d=parseBRDate(s); return !!(d && (new Date() - d) > 0); };
    const urgencyByDate = (dateStr,status)=>{
      if(status==='done'||status==='FINALIZADA') return 'done';
      if(isPastDue(dateStr)) return 'overdue';
      if(status==='recebido') return 'recv';
      if(status==='block') return 'block';
      if(status==='exec') return 'exec';
      const d=parseBRDate(dateStr); if(!d) return 'ok';
      const h=(d-new Date())/HOUR; return (h<=48)?'soon':'ok';
    };
    const compareByPrazo = (a,b)=>{
      const u = ds => { const d=parseBRDate(ds); if(!d) return 3; const h=(d-new Date())/HOUR; return (h<=0)?0:(h<=48?1:2) };
      const aDate=a.prazo_esperado||a.prazo||a.previsao||a.data||'';
      const bDate=b.prazo_esperado||b.prazo||b.previsao||b.data||'';
      const ua=u(aDate), ub=u(bDate);
      if(ua!==ub) return ua-ub;
      const da=parseBRDate(aDate), db=parseBRDate(bDate);
      if(da&&db) return da-db; if(da&&!db) return -1; if(!da&&db) return 1; return 0;
    };
    const compareOC = (a,b)=>{
      const ar=!!a.recebido, br=!!b.recebido; if(ar!==br) return (br - ar);
      if(ar&&br){ const da=parseBRDate(a.recebido), db=parseBRDate(b.recebido); if(da&&db) return db-da; if(da&&!db) return -1; if(!da&&db) return 1; }
      return compareByPrazo({previsao:a.previsao,status:a.status},{previsao:b.previsao,status:b.status});
    };

    /* ===== Share helpers ===== */
    function formatStatus(status, dueStr){
      if(status==='exec') return 'Em execu√ß√£o';
      if(status==='block') return 'Bloqueada';
      if(status==='done'||status==='FINALIZADA') return 'Finalizada';
      return isPastDue(dueStr)?'Atrasada':'Pendente';
    }
    function nowStamp(){
      const d = new Date();
      const dd = pad(d.getDate()), mm = pad(d.getMonth()+1), yyyy=d.getFullYear();
      const hh = pad(d.getHours()), mi = pad(d.getMinutes());
      return `${dd}/${mm}/${yyyy} ${hh}:${mi}`;
    }
    function buildTaskMessage(t, encarregado, note){
      const due = t.prazo_esperado||t.prazo||'-';
      const status = formatStatus(t.status, due);
      const pct = Math.max(0, Math.min(100, Number(t.pct||0)));
      const header = `*${t.codigo||''} ‚Äî ${t.titulo}*`;
      const body = [
        `Respons√°vel: ${encarregado}`,
        `Status: ${status} ‚Ä¢ Avan√ßo: ${pct}%`,
        `Prazo: ${due}${due? ` (${dLabel(due)})`:''}`,
        t.obs? `Obs.: ${t.obs}`: null,
      ].filter(Boolean).join('\n');
      const stamp = nowStamp();
      const comment = `*Coment√°rio (${stamp}):* ${note}`;
      return `${header}\n${body}\n\n${comment}`;
    }
    function openWhatsAppWithText(text){
      const enc = encodeURIComponent(text);
      const isMobile = /Android|iPhone|iPad|iPod|Windows Phone/i.test(navigator.userAgent);
      const deeplink = `whatsapp://send?text=${enc}`;
      const web = `https://wa.me/?text=${enc}`;
      if(isMobile){
        const w = window.open(deeplink, '_blank');
        setTimeout(()=>{ if(!w || w.closed) window.open(web, '_blank'); }, 600);
      } else {
        window.open(web, '_blank');
      }
    }

    /* ===== Modal ===== */
    const modal = $('#shareModal');
    const noteEl = $('#shareNote');
    const sendBtn = $('#shareSend');
    const cancelBtn = $('#shareCancel');
    let shareCtx = null;
    function openModal(ctx){ shareCtx = ctx; noteEl.value=''; modal.classList.add('open'); noteEl.focus(); }
    function closeModal(){ modal.classList.remove('open'); shareCtx=null; }
    cancelBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', e=>{ if(e.target===modal) closeModal(); });

    sendBtn.addEventListener('click', ()=>{
      if(!shareCtx) return;
      const note = noteEl.value.trim();
      if(!note){ noteEl.focus(); noteEl.setCustomValidity('Digite uma nota.'); noteEl.reportValidity(); setTimeout(()=>noteEl.setCustomValidity(''), 800); return; }
      const msg = buildTaskMessage(shareCtx.t, shareCtx.enc, note);
      closeModal();
      openWhatsAppWithText(msg);
    });

    /* ===== Render ===== */
    const boardEl = $('#board');

    // Regra: pct>0 => Em execu√ß√£o (se n√£o bloqueada ou finalizada)
    function normalizeStatus(t){
      const pct = Number(t.pct||0);
      if(pct>=100){ t.status='done'; return; }
      if((t.status||'').toLowerCase()==='block') return;
      if(pct>0){ t.status='exec'; }
    }

    function isDone(t){ return t.status==='done' || t.status==='FINALIZADA' || Number(t.pct||0) >= 100; }
    function sortTasksWithDoneLast(a,b){
      const ad = isDone(a), bd = isDone(b);
      if(ad !== bd) return ad ? 1 : -1;
      return compareByPrazo(a,b);
    }

    function renderEncColumns(){
      for(const enc of DATA.encarregados){
        const col = el('section','column'); col.setAttribute('role','region'); col.setAttribute('aria-label',enc.nome);
        col.appendChild(el('h2','',enc.nome));
        const list = el('div','list');
        const tasks = (enc.tarefas||[]).slice().sort(sortTasksWithDoneLast);
        for(const t of tasks){
          normalizeStatus(t);
          const pct = Math.max(0, Math.min(100, Number(t.pct||0)));
          const dueStr = t.prazo_esperado||t.prazo||'';
          const urg = urgencyByDate(dueStr,t.status);
          const card = el('article', 'task '+urg);
          card.dataset.st = (t.status||'').toLowerCase();
          card.dataset.urg = urg;

          const header = el('div','');
          header.appendChild(el('span','code','#'+(t.codigo||'')));
          const title = el('span','title'); title.textContent = t.titulo; header.appendChild(title);

          const btn = document.createElement('button');
          btn.className='share-btn'; btn.type='button'; btn.title='Compartilhar no WhatsApp'; btn.setAttribute('aria-label','Compartilhar no WhatsApp');
          btn.innerHTML = '<svg class="wa-ico" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M16 3C9.373 3 4 8.373 4 15c0 2.11.548 4.09 1.504 5.82L4 29l8.332-1.46C14.016 28.48 15.975 29 18 29c6.627 0 12-5.373 12-12S22.627 3 16 3zm0 2c5.523 0 10 4.477 10 10s-4.477 10-10 10c-1.822 0-3.53-.5-4.99-1.365l-.356-.213-4.7.824.85-4.572-.232-.375C5.557 18.188 5 16.65 5 15 5 9.477 10.477 5 16 5zm-4.04 4.75c-.202 0-.52.074-.792.37-.272.296-1.04 1.015-1.04 2.469s1.06 2.864 1.22 3.079c.162.215 2.09 3.183 5.073 4.454.715.305 1.273.484 1.71.617.72.22 1.372.186 1.89.11.58-.083 1.78-.73 2.04-1.43.26-.7.26-1.316.19-1.437-.07-.12-.277-.196-.575-.337-.298-.14-1.75-.87-2.02-.97-.27-.1-.47-.144-.668.14-.198.283-.786.942-.958 1.128-.17.186-.334.202-.624.067-.29-.135-1.24-.46-2.37-1.485-.88-.798-1.49-1.783-1.66-2.082-.17-.3-.02-.466.124-.61.122-.12.3-.33.447-.5.147-.17.2-.294.308-.49.108-.196.053-.368-.022-.512-.075-.143-.683-1.64-.94-2.236-.256-.595-.503-.52-.682-.52z" fill="#fff"/>';
          btn.addEventListener('click', (e)=>{ e.stopPropagation(); openModal({t, enc: enc.nome}); });

          const meta = el('div','meta-text');
          const parts = [];
          let p1 = 'Prazo esperado: '+(dueStr||'-');
          if(t.status!=='done' && t.status!=='FINALIZADA') p1 += ' ‚Ä¢ '+dLabel(dueStr||'');
          parts.push(p1);
          if(t.obs) parts.push('Obs.: '+t.obs);
          meta.innerHTML = parts.map(p=>`<div>${p}</div>`).join('');

          let statusLabel='Pendente';
          if(t.status==='exec') statusLabel='Em execu√ß√£o'; else if(t.status==='block') statusLabel='Bloqueada'; else if(t.status==='done'||t.status==='FINALIZADA') statusLabel='Finalizada üèÜ'; else if(card.className.includes('overdue')) statusLabel='Atrasada';
          const chip = el('span','chip',statusLabel); meta.appendChild(chip);

          const pWrap = el('div','progress'); const pBar = el('div','progress-inner'); pBar.style.width = pct+'%'; pWrap.appendChild(pBar);
          const pLabel = el('div','progress-label'); pLabel.appendChild(el('span','', 'Avan√ßo: '+pct+'%'));

          card.appendChild(header); card.appendChild(meta); card.appendChild(pWrap); card.appendChild(pLabel); card.appendChild(btn);
          list.appendChild(card);
        }
        col.appendChild(list); boardEl.appendChild(col);
      }
    }

    function renderSuppliesColumn(){
      const sup = DATA.suprimentos || {}; const rqs=(sup.requisicoes||[]).slice(); const ocs=(sup.ocs||[]).slice();
      rqs.sort((a,b)=>compareByPrazo(a,b)); ocs.sort(compareOC);
      const col = el('section','column'); col.setAttribute('role','region'); col.setAttribute('aria-label','Suprimentos');
      col.appendChild(el('h2','', 'Suprimentos'));
      const list = el('div','list');

      const rqHdr = el('div','title','Requisi√ß√µes em Aberto'); list.appendChild(rqHdr);
      for(const rq of rqs){
        const it = el('article','item '+urgencyByDate(rq.prazo, rq.status));
        const rowTop=el('div','row'); const left=el('div');
        left.appendChild(el('span','code','#'+(rq.codigo||rq.numero||''))); left.appendChild(el('strong','',rq.numero||rq.codigo||'RQ'));
        rowTop.appendChild(left); rowTop.appendChild(el('span','',rq.status||''));
        const kv1=el('div','kv','Data: '+(rq.data||'-')+' ‚Ä¢ Prazo: '+(rq.prazo||'-'));
        const kv2=el('div','kv','Resp.: '+(rq.responsavel||'-')+' ‚Ä¢ Contrato: '+(rq.contrato||'-')+' ‚Ä¢ Material: '+(rq.material||'-'));
        const kv3=el('div','kv','Aplica√ß√£o: '+(rq.aplicacao||'-')+' ‚Ä¢ Obs.: '+(rq.obs||'-'));
        it.appendChild(rowTop); it.appendChild(kv1); it.appendChild(kv2); it.appendChild(kv3);
        list.appendChild(it);
      }

      const ocHdr = el('div','title','Ordens de Compra (OC)'); list.appendChild(ocHdr);
      for(const oc of ocs){
        const cls = oc.recebido? 'recv' : urgencyByDate(oc.previsao, oc.status);
        const it2 = el('article','item '+cls);
        const rowTop2=el('div','row'); const left2=el('div');
        left2.appendChild(el('span','code','#'+(oc.codigo||oc.numero||''))); left2.appendChild(el('strong','',oc.numero||oc.codigo||'OC'));
        rowTop2.appendChild(left2); rowTop2.appendChild(el('span','',oc.status||''));
        const kv3=el('div','kv','Fornecedor: '+(oc.fornecedor||'-')+' ‚Ä¢ Comprador: '+(oc.comprador||'-')+' ‚Ä¢ Origem: '+(oc.origem_rq||'-'));
        const kv4=el('div','kv','Material: '+(oc.material||'-')+' ‚Ä¢ Aplica√ß√£o: '+(oc.aplicacao||'-'));
        const kv5=el('div','kv','Emiss√£o: '+(oc.emissao||'-')+' ‚Ä¢ Previs√£o: '+(oc.previsao||'-'));
        const st=el('div','kv', oc.recebido?('Recebido em '+oc.recebido):'Pendente');
        it2.appendChild(rowTop2); it2.appendChild(kv3); it2.appendChild(kv4); it2.appendChild(kv5); it2.appendChild(st);
        if(oc.obs_comprador) it2.appendChild(el('div','kv','Obs. comprador: '+(oc.obs_comprador||'')));
        list.appendChild(it2);
      }

      col.appendChild(list); boardEl.appendChild(col);
    }

    function render(){
      boardEl.innerHTML='';
      renderEncColumns();
      renderSuppliesColumn();
      updateFilterCounts();
      applyFilters();
    }

    function pad2(n){return String(n).padStart(2,'0')}
    function fmtClock(){ const t=new Date(); return `${pad2(t.getHours())}:${pad2(t.getMinutes())}:${pad2(t.getSeconds())}` }
    function setStamp(){ const d=new Date(); const stamp=`${pad2(d.getDate())}/${pad2(d.getMonth()+1)}/${d.getFullYear()} ${pad2(d.getHours())}:${pad2(d.getMinutes())}`; document.getElementById('stamp').textContent=stamp; }

    /* ===== Filtros de status ===== */
    const active = new Set(['all']);

    function isPending(card){
      const st = (card.dataset.st||'').toLowerCase();
      const urg = (card.dataset.urg||'').toLowerCase();
      const pctEl = card.querySelector('.progress-inner');
      let pct = 0;
      if(pctEl){
        const w = pctEl.style.width || '0%';
        pct = parseFloat(w);
      }
      if(pct > 0) return false;
      if(st==='done') return false;
      if(urg==='overdue' || st==='block' || st==='exec') return false;
      return (urg==='ok' || urg==='soon' || !urg);
    }

    function cardMatches(card){
      if(active.has('all') || active.size===0) return true;
      const st = (card.dataset.st||'').toLowerCase();
      const urg = (card.dataset.urg||'').toLowerCase();
      let match = false;
      if(active.has('exec') && st==='exec') match = true;
      if(active.has('block') && st==='block') match = true;
      if(active.has('done') && st==='done') match = true;
      if(active.has('overdue') && urg==='overdue') match = true;
      if(active.has('pending') && isPending(card)) match = true;
      return match;
    }

    function applyFilters(){
      const cards = $$('.task');
      for(const c of cards){
        c.classList.toggle('hidden', !cardMatches(c));
      }
    }

    function updateFilterCounts(){
      const cards = $$('.task');
      const counters = {all: cards.length, exec:0, block:0, overdue:0, pending:0, done:0};
      for(const c of cards){
        const st=(c.dataset.st||'').toLowerCase();
        const urg=(c.dataset.urg||'').toLowerCase();
        const pctEl = c.querySelector('.progress-inner');
        const pct = pctEl ? parseFloat((pctEl.style.width||'0%')) : 0;
        if(st==='exec' || pct>0) counters.exec++;
        if(st==='block') counters.block++;
        if(st==='done') counters.done++;
        if(urg==='overdue') counters.overdue++;
        if(isPending(c)) counters.pending++;
      }
      for(const k of Object.keys(counters)){
        const el = document.querySelector(`[data-cnt="${k}"]`);
        if(el) el.textContent = counters[k];
      }
    }

    function toggleBtn(btn){
      const val = btn.dataset.val;
      const pressed = btn.getAttribute('aria-pressed') === 'true';
      if(val==='clear'){
        for(const b of document.querySelectorAll('.filters .fbtn')){ b.setAttribute('aria-pressed','false'); }
        active.clear(); active.add('all');
        document.querySelector('.fbtn[data-val="all"]').setAttribute('aria-pressed','true');
      } else if(val==='all'){
        for(const b of document.querySelectorAll('.filters .fbtn')){ if(b.dataset.val!=='clear') b.setAttribute('aria-pressed','false'); }
        active.clear(); active.add('all');
        btn.setAttribute('aria-pressed','true');
      } else {
        document.querySelector('.fbtn[data-val="all"]').setAttribute('aria-pressed','false');
        active.delete('all');
        btn.setAttribute('aria-pressed', String(!pressed));
        if(pressed){ active.delete(val); } else { active.add(val); }
        if(active.size===0){ active.add('all'); document.querySelector('.fbtn[data-val="all"]').setAttribute('aria-pressed','true'); }
      }
      applyFilters();
    }

    function bindFilters(){
      for(const b of document.querySelectorAll('.filters .fbtn')){
        b.addEventListener('click', ()=> toggleBtn(b));
      }
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      render();
      bindFilters();
      setStamp();
      document.getElementById('clock').textContent = fmtClock();
      setInterval(()=>document.getElementById('clock').textContent = fmtClock(), 1000);
    });
  })();
  </script>
</body>
</html>
